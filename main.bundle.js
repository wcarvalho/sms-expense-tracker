/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,l=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(h=64)),i.push(n[u],n[l],n[h],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==o||null==a||null==c)throw new i;const u=r<<2|o>>4;if(s.push(u),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},r=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t="MISSING_ENV_VAR".__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=r())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class l extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(d,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new l(i,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(p(n)&&p(r)){if(!f(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}function g(t,e=1e3,n=2){const i=e*Math.pow(n,t),s=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+s)}function m(t){return t&&t._delegate?t._delegate:t}class y{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const v="[DEFAULT]";class w{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:v})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=v){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=v){return this.instances.has(t)}getOptions(t=v){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===v?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=v){return this.component?this.component.multipleInstances?t:v:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class b{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new w(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const E=[];var I;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(I||(I={}));const T={debug:I.DEBUG,verbose:I.VERBOSE,info:I.INFO,warn:I.WARN,error:I.ERROR,silent:I.SILENT},S=I.INFO,C={[I.DEBUG]:"log",[I.VERBOSE]:"log",[I.INFO]:"info",[I.WARN]:"warn",[I.ERROR]:"error"},_=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=C[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class A{constructor(t){this.name=t,this._logLevel=S,this._logHandler=_,this._userLogHandler=null,E.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in I))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?T[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,I.DEBUG,...t),this._logHandler(this,I.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,I.VERBOSE,...t),this._logHandler(this,I.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,I.INFO,...t),this._logHandler(this,I.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,I.WARN,...t),this._logHandler(this,I.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,I.ERROR,...t),this._logHandler(this,I.ERROR,...t)}}let D,N;const k=new WeakMap,x=new WeakMap,R=new WeakMap,L=new WeakMap,M=new WeakMap;let O={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return x.get(t);if("objectStoreNames"===e)return t.objectStoreNames||R.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return F(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(N||(N=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(V(this),t),F(k.get(this))}:function(...t){return F(e.apply(V(this),t))}:function(t,...n){const i=e.call(V(this),t,...n);return R.set(i,t.sort?t.sort():[t]),F(i)}:(t instanceof IDBTransaction&&function(t){if(x.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));x.set(t,e)}(t),n=t,(D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,O):t);var e,n}function F(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(F(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&k.set(e,t)})).catch((()=>{})),M.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=P(t);return e!==t&&(L.set(t,e),M.set(e,t)),e}const V=t=>M.get(t),U=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],j=new Map;function q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(j.get(e))return j.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=B.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!U.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return j.set(e,r),r}var $;$=O,O={...$,get:(t,e,n)=>q(t,e)||$.get(t,e,n),has:(t,e)=>!!q(t,e)||$.has(t,e)};class z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const K="@firebase/app",G="0.9.13",H=new A("@firebase/app"),Q="@firebase/app-compat",W="@firebase/analytics-compat",Y="@firebase/analytics",X="@firebase/app-check-compat",J="@firebase/app-check",Z="@firebase/auth",tt="@firebase/auth-compat",et="@firebase/database",nt="@firebase/database-compat",it="@firebase/functions",st="@firebase/functions-compat",rt="@firebase/installations",ot="@firebase/installations-compat",at="@firebase/messaging",ct="@firebase/messaging-compat",ut="@firebase/performance",lt="@firebase/performance-compat",ht="@firebase/remote-config",dt="@firebase/remote-config-compat",ft="@firebase/storage",pt="@firebase/storage-compat",gt="@firebase/firestore",mt="@firebase/firestore-compat",yt="firebase",vt="[DEFAULT]",wt={[K]:"fire-core",[Q]:"fire-core-compat",[Y]:"fire-analytics",[W]:"fire-analytics-compat",[J]:"fire-app-check",[X]:"fire-app-check-compat",[Z]:"fire-auth",[tt]:"fire-auth-compat",[et]:"fire-rtdb",[nt]:"fire-rtdb-compat",[it]:"fire-fn",[st]:"fire-fn-compat",[rt]:"fire-iid",[ot]:"fire-iid-compat",[at]:"fire-fcm",[ct]:"fire-fcm-compat",[ut]:"fire-perf",[lt]:"fire-perf-compat",[ht]:"fire-rc",[dt]:"fire-rc-compat",[ft]:"fire-gcs",[pt]:"fire-gcs-compat",[gt]:"fire-fst",[mt]:"fire-fst-compat","fire-js":"fire-js",[yt]:"fire-js-all"},bt=new Map,Et=new Map;function It(t,e){try{t.container.addComponent(e)}catch(n){H.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tt(t){const e=t.name;if(Et.has(e))return H.debug(`There were multiple attempts to register component ${e}.`),!1;Et.set(e,t);for(const e of bt.values())It(e,t);return!0}function St(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Ct=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class _t{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new y("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ct.create("app-deleted",{appName:this._name})}}function At(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:vt,automaticDataCollectionEnabled:!1},e),s=i.name;if("string"!=typeof s||!s)throw Ct.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw Ct.create("no-options");const r=bt.get(s);if(r){if(f(n,r.options)&&f(i,r.config))return r;throw Ct.create("duplicate-app",{appName:s})}const a=new b(s);for(const t of Et.values())a.addComponent(t);const c=new _t(n,i,a);return bt.set(s,c),c}function Dt(t=vt){const e=bt.get(t);if(!e&&t===vt&&o())return At();if(!e)throw Ct.create("no-app",{appName:t});return e}function Nt(t,e,n){var i;let s=null!==(i=wt[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void H.warn(t.join(" "))}Tt(new y(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const kt="firebase-heartbeat-store";let xt=null;function Rt(){return xt||(xt=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=F(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(F(o.result),t.oldVersion,t.newVersion,F(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(kt)}}).catch((t=>{throw Ct.create("idb-open",{originalErrorMessage:t.message})}))),xt}async function Lt(t,e){try{const n=(await Rt()).transaction(kt,"readwrite"),i=n.objectStore(kt);await i.put(e,Mt(t)),await n.done}catch(t){if(t instanceof l)H.warn(t.message);else{const e=Ct.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}function Mt(t){return`${t.name}!${t.options.appId}`}class Ot{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ft(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Pt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Pt(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Vt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Vt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Pt(){return(new Date).toISOString().substring(0,10)}class Ft{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await Rt();return await e.transaction(kt).objectStore(kt).get(Mt(t))}catch(t){if(t instanceof l)H.warn(t.message);else{const e=Ct.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Vt(t){return s(JSON.stringify({version:2,heartbeats:t})).length}let Ut,Bt;Tt(new y("platform-logger",(t=>new z(t)),"PRIVATE")),Tt(new y("heartbeat",(t=>new Ot(t)),"PRIVATE")),Nt(K,G,""),Nt(K,G,"esm2017"),Nt("fire-js",""),Nt("firebase","9.23.0","app");const jt=new WeakMap,qt=new WeakMap,$t=new WeakMap,zt=new WeakMap,Kt=new WeakMap;let Gt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return qt.get(t);if("objectStoreNames"===e)return t.objectStoreNames||$t.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Qt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Ht(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Bt||(Bt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Wt(this),t),Qt(jt.get(this))}:function(...t){return Qt(e.apply(Wt(this),t))}:function(t,...n){const i=e.call(Wt(this),t,...n);return $t.set(i,t.sort?t.sort():[t]),Qt(i)}:(t instanceof IDBTransaction&&function(t){if(qt.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));qt.set(t,e)}(t),n=t,(Ut||(Ut=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,Gt):t);var e,n}function Qt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(Qt(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&jt.set(e,t)})).catch((()=>{})),Kt.set(e,t),e}(t);if(zt.has(t))return zt.get(t);const e=Ht(t);return e!==t&&(zt.set(t,e),Kt.set(e,t)),e}const Wt=t=>Kt.get(t),Yt=["get","getKey","getAll","getAllKeys","count"],Xt=["put","add","delete","clear"],Jt=new Map;function Zt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Jt.get(e))return Jt.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=Xt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!Yt.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return Jt.set(e,r),r}Gt=(t=>({...t,get:(e,n,i)=>Zt(e,n)||t.get(e,n,i),has:(e,n)=>!!Zt(e,n)||t.has(e,n)}))(Gt);const te="@firebase/installations",ee="0.6.4",ne=`w:${ee}`,ie="FIS_v2",se=new h("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function re(t){return t instanceof l&&t.code.includes("request-failed")}function oe({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function ae(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function ce(t,e){const n=(await e.json()).error;return se.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ue({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function le(t){const e=await t();return e.status>=500&&e.status<600?t():e}function he(t){return new Promise((e=>{setTimeout(e,t)}))}const de=/^[cdef][\w-]{21}$/;function fe(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return de.test(e)?e:""}catch(t){return""}}function pe(t){return`${t.appName}!${t.appId}`}const ge=new Map;function me(t,e){const n=pe(t);ye(n,e),function(t,e){const n=(!ve&&"BroadcastChannel"in self&&(ve=new BroadcastChannel("[Firebase] FID Change"),ve.onmessage=t=>{ye(t.data.key,t.data.fid)}),ve);n&&n.postMessage({key:t,fid:e}),0===ge.size&&ve&&(ve.close(),ve=null)}(n,e)}function ye(t,e){const n=ge.get(t);if(n)for(const t of n)t(e)}let ve=null;const we="firebase-installations-store";let be=null;function Ee(){return be||(be=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=Qt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Qt(o.result),t.oldVersion,t.newVersion,Qt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(we)}})),be}async function Ie(t,e){const n=pe(t),i=(await Ee()).transaction(we,"readwrite"),s=i.objectStore(we),r=await s.get(n);return await s.put(e,n),await i.done,r&&r.fid===e.fid||me(t,e.fid),e}async function Te(t){const e=pe(t),n=(await Ee()).transaction(we,"readwrite");await n.objectStore(we).delete(e),await n.done}async function Se(t,e){const n=pe(t),i=(await Ee()).transaction(we,"readwrite"),s=i.objectStore(we),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||me(t,o.fid),o}async function Ce(t){let e;const n=await Se(t.appConfig,(n=>{const i=function(t){return De(t||{fid:fe(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(se.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=oe(t),s=ue(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:ie,appId:t.appId,sdkVersion:ne},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await le((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:ae(t.authToken)}}throw await ce("Create Installation",c)}(t,e);return Ie(t.appConfig,n)}catch(n){throw re(n)&&409===n.customData.serverCode?await Te(t.appConfig):await Ie(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:_e(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function _e(t){let e=await Ae(t.appConfig);for(;1===e.registrationStatus;)await he(100),e=await Ae(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Ce(t);return n||e}return e}function Ae(t){return Se(t,(t=>{if(!t)throw se.create("installation-not-found");return De(t)}))}function De(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Ne({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${oe(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=ue(t);return n.append("Authorization",function(t){return`${ie} ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:ne,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await le((()=>fetch(i,a)));if(c.ok)return ae(await c.json());throw await ce("Generate Auth Token",c)}async function ke(t,e=!1){let n;const i=await Se(t.appConfig,(i=>{if(!Re(i))throw se.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await xe(t.appConfig);for(;1===n.authToken.requestStatus;)await he(100),n=await xe(t.appConfig);const i=n.authToken;return 0===i.requestStatus?ke(t,e):i}(t,e),i;{if(!navigator.onLine)throw se.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await Ne(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Ie(t.appConfig,i),n}catch(n){if(!re(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ie(t.appConfig,n)}else await Te(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function xe(t){return Se(t,(t=>{if(!Re(t))throw se.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Re(t){return void 0!==t&&2===t.registrationStatus}function Le(t){return se.create("missing-app-config-values",{valueName:t})}const Me="installations";Tt(new y(Me,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Le("App Configuration");if(!t.name)throw Le("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Le(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:St(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Tt(new y("installations-internal",(t=>{const e=St(t.getProvider("app").getImmediate(),Me).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await Ce(e);return i?i.catch(console.error):ke(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Ce(t);e&&await e}(n),(await ke(n,e)).token}(e,t)}}),"PRIVATE")),Nt(te,ee),Nt(te,ee,"esm2017");const Oe="analytics",Pe="https://www.googletagmanager.com/gtag/js",Fe=new A("@firebase/analytics"),Ve=new h("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Ue(t){if(!t.startsWith(Pe)){const e=Ve.create("invalid-gtag-resource",{gtagURL:t});return Fe.warn(e.message),""}return t}function Be(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const je=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function qe(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function $e(t,e=je,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw Ve.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Ve.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Ke;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),ze({appId:i,apiKey:s,measurementId:r},o,a,e)}async function ze(t,{throttleEndTimeMillis:e,backoffCount:n},i,s=je){var r;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener((()=>{clearTimeout(r),i(Ve.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return Fe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,s={method:"GET",headers:qe(i)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Ve.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return s.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof l&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(s.deleteThrottleMetadata(o),a)return Fe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(r=null==c?void 0:c.customData)||void 0===r?void 0:r.httpStatus)?g(n,s.intervalMillis,30):g(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return s.setThrottleMetadata(o,h),Fe.debug(`Calling attemptFetch again in ${u} millis`),ze(t,h,i,s)}}class Ke{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Ge,He;async function Qe(t,e,n,i,s,r,o){var a;const l=$e(t);l.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Fe.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Fe.error(t))),e.push(l);const h=async function(){if(!c())return Fe.warn(Ve.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return Fe.warn(Ve.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([l,h]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Pe)&&n.src.includes(t))return n;return null})(r)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:Ue}),i=document.createElement("script"),s=`${Pe}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}(r,d.measurementId),He&&(s("consent","default",He),He=void 0),s("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),s("config",d.measurementId,p),Ge&&(s("set",Ge),Ge=void 0),d.measurementId}class We{constructor(t){this.app=t}_delete(){return delete Ye[this.app.options.appId],Promise.resolve()}}let Ye={},Xe=[];const Je={};let Ze,tn,en="dataLayer",nn=!1;function sn(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Ve.create("invalid-analytics-context",{errorInfo:e});Fe.warn(n.message)}}();const i=t.options.appId;if(!i)throw Ve.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Ve.create("no-api-key");Fe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ye[i])throw Ve.create("already-exists",{id:i});if(!nn){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(en);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,s){let r=function(...t){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(t,e,n,i){return async function(s,...r){try{if("event"===s){const[i,s]=r;await async function(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let t=s.send_to;Array.isArray(t)||(t=[t]);const i=await Be(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),s=t&&e[t.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(t){Fe.error(t)}}(t,e,n,i,s)}else if("config"===s){const[s,o]=r;await async function(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const t=(await Be(n)).find((t=>t.measurementId===s));t&&await e[t.appId]}}catch(t){Fe.error(t)}t("config",s,r)}(t,e,n,i,s,o)}else if("consent"===s){const[e]=r;t("consent","update",e)}else if("get"===s){const[e,n,i]=r;t("get",e,n,i)}else if("set"===s){const[e]=r;t("set",e)}else t(s,...r)}catch(t){Fe.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window[s]}}(Ye,Xe,Je,en,"gtag");tn=t,Ze=e,nn=!0}return Ye[i]=Qe(t,Xe,Je,e,Ze,en,n),new We(t)}const rn="@firebase/analytics",on="0.10.0";Tt(new y(Oe,((t,{options:e})=>sn(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),Tt(new y("analytics-internal",(function(t){try{const e=t.getProvider(Oe).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=m(t),async function(t,e,n,i,s){if(s&&s.global)t("event",n,i);else{const s=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(tn,Ye[t.app.options.appId],e,n,i).catch((t=>Fe.error(t)))}(e,t,n,i)}}catch(t){throw Ve.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Nt(rn,on),Nt(rn,on,"esm2017");var an,cn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},un={},ln=ln||{},hn=cn||self;function dn(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function fn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var pn="closure_uid_"+(1e9*Math.random()>>>0),gn=0;function mn(t,e,n){return t.call.apply(t.bind,arguments)}function yn(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function vn(t,e,n){return(vn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?mn:yn).apply(null,arguments)}function wn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function bn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function En(){this.s=this.s,this.o=this.o}En.prototype.s=!1,En.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,pn)&&t[pn]||(t[pn]=++gn))},En.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const In=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Tn(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function Sn(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(dn(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let s=0;s<i;s++)t[e+s]=n[s]}else t.push(n)}}function Cn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Cn.prototype.h=function(){this.defaultPrevented=!0};var _n=function(){if(!hn.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{hn.addEventListener("test",(()=>{}),e),hn.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function An(t){return/^[\s\xa0]*$/.test(t)}function Dn(){var t=hn.navigator;return t&&(t=t.userAgent)?t:""}function Nn(t){return-1!=Dn().indexOf(t)}function kn(t){return kn[" "](t),t}kn[" "]=function(){};var xn,Rn,Ln,Mn=Nn("Opera"),On=Nn("Trident")||Nn("MSIE"),Pn=Nn("Edge"),Fn=Pn||On,Vn=Nn("Gecko")&&!(-1!=Dn().toLowerCase().indexOf("webkit")&&!Nn("Edge"))&&!(Nn("Trident")||Nn("MSIE"))&&!Nn("Edge"),Un=-1!=Dn().toLowerCase().indexOf("webkit")&&!Nn("Edge");function Bn(){var t=hn.document;return t?t.documentMode:void 0}t:{var jn="",qn=(Rn=Dn(),Vn?/rv:([^\);]+)(\)|;)/.exec(Rn):Pn?/Edge\/([\d\.]+)/.exec(Rn):On?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Rn):Un?/WebKit\/(\S+)/.exec(Rn):Mn?/(?:Version)[ \/]?(\S+)/.exec(Rn):void 0);if(qn&&(jn=qn?qn[1]:""),On){var $n=Bn();if(null!=$n&&$n>parseFloat(jn)){xn=String($n);break t}}xn=jn}hn.document&&On?Ln=Bn()||parseInt(xn,10)||void 0:Ln=void 0;var zn=Ln;function Kn(t,e){if(Cn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Vn){t:{try{kn(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Gn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Kn.$.h.call(this)}}bn(Kn,Cn);var Gn={2:"touch",3:"pen",4:"mouse"};Kn.prototype.h=function(){Kn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Hn="closure_listenable_"+(1e6*Math.random()|0),Qn=0;function Wn(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=s,this.key=++Qn,this.fa=this.ia=!1}function Yn(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Xn(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Jn(t){const e={};for(const n in t)e[n]=t[n];return e}const Zn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ti(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<Zn.length;e++)n=Zn[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function ei(t){this.src=t,this.g={},this.h=0}function ni(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=In(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Yn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ii(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.fa&&r.listener==e&&r.capture==!!n&&r.la==i)return s}return-1}ei.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=ii(t,e,i,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Wn(e,this.src,r,!!i,s)).ia=n,t.push(e)),e};var si="closure_lm_"+(1e6*Math.random()|0),ri={};function oi(t,e,n,i,s){if(i&&i.once)return ci(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)oi(t,e[r],n,i,s);return null}return n=gi(n),t&&t[Hn]?t.O(e,n,fn(i)?!!i.capture:!!i,s):ai(t,e,n,!1,i,s)}function ai(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=fn(s)?!!s.capture:!!s,a=fi(t);if(a||(t[si]=a=new ei(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){const t=di;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)_n||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(hi(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function ci(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)ci(t,e[r],n,i,s);return null}return n=gi(n),t&&t[Hn]?t.P(e,n,fn(i)?!!i.capture:!!i,s):ai(t,e,n,!0,i,s)}function ui(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)ui(t,e[r],n,i,s);else i=fn(i)?!!i.capture:!!i,n=gi(n),t&&t[Hn]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ii(r=t.g[e],n,i,s))&&(Yn(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=fi(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ii(e,n,i,s)),(n=-1<t?e[t]:null)&&li(n))}function li(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Hn])ni(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(hi(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=fi(e))?(ni(n,t),0==n.h&&(n.src=null,e[si]=null)):Yn(t)}}}function hi(t){return t in ri?ri[t]:ri[t]="on"+t}function di(t,e){if(t.fa)t=!0;else{e=new Kn(e,this);var n=t.listener,i=t.la||t.src;t.ia&&li(t),t=n.call(i,e)}return t}function fi(t){return(t=t[si])instanceof ei?t:null}var pi="__closure_events_fn_"+(1e9*Math.random()>>>0);function gi(t){return"function"==typeof t?t:(t[pi]||(t[pi]=function(e){return t.handleEvent(e)}),t[pi])}function mi(){En.call(this),this.i=new ei(this),this.S=this,this.J=null}function yi(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new Cn(e,t);else if(e instanceof Cn)e.target=e.target||t;else{var s=e;ti(e=new Cn(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=vi(o,i,!0,e)&&s}if(s=vi(o=e.g=t,i,!0,e)&&s,s=vi(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=vi(o=e.g=n[r],i,!1,e)&&s}function vi(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&ni(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}bn(mi,En),mi.prototype[Hn]=!0,mi.prototype.removeEventListener=function(t,e,n,i){ui(this,t,e,n,i)},mi.prototype.N=function(){if(mi.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Yn(n[i]);delete e.g[t],e.h--}}this.J=null},mi.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},mi.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var wi=hn.JSON.stringify;function bi(){var t=Ai;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ei=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ii),(t=>t.reset()));class Ii{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ti(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Si(t){hn.setTimeout((()=>{throw t}),0)}let Ci,_i=!1,Ai=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ei.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Di=()=>{const t=hn.Promise.resolve(void 0);Ci=()=>{t.then(Ni)}};var Ni=()=>{for(var t;t=bi();){try{t.h.call(t.g)}catch(t){Si(t)}var e=Ei;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}_i=!1};function ki(t,e){mi.call(this),this.h=t||1,this.g=e||hn,this.j=vn(this.qb,this),this.l=Date.now()}function xi(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Ri(t,e,n){if("function"==typeof t)n&&(t=vn(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=vn(t.handleEvent,t)}return 2147483647<Number(e)?-1:hn.setTimeout(t,e||0)}function Li(t){t.g=Ri((()=>{t.g=null,t.i&&(t.i=!1,Li(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}bn(ki,mi),(an=ki.prototype).ga=!1,an.T=null,an.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),yi(this,"tick"),this.ga&&(xi(this),this.start()))}},an.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},an.N=function(){ki.$.N.call(this),xi(this),delete this.g};class Mi extends En{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Li(this)}N(){super.N(),this.g&&(hn.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oi(t){En.call(this),this.h=t,this.g={}}bn(Oi,En);var Pi=[];function Fi(t,e,n,i){Array.isArray(n)||(n&&(Pi[0]=n.toString()),n=Pi);for(var s=0;s<n.length;s++){var r=oi(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Vi(t){Xn(t.g,(function(t,e){this.g.hasOwnProperty(e)&&li(t)}),t),t.g={}}function Ui(){this.g=!0}function Bi(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return wi(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Oi.prototype.N=function(){Oi.$.N.call(this),Vi(this)},Oi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ui.prototype.Ea=function(){this.g=!1},Ui.prototype.info=function(){};var ji={},qi=null;function $i(){return qi=qi||new mi}function zi(t){Cn.call(this,ji.Ta,t)}function Ki(t){const e=$i();yi(e,new zi(e))}function Gi(t,e){Cn.call(this,ji.STAT_EVENT,t),this.stat=e}function Hi(t){const e=$i();yi(e,new Gi(e,t))}function Qi(t,e){Cn.call(this,ji.Ua,t),this.size=e}function Wi(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return hn.setTimeout((function(){t()}),e)}ji.Ta="serverreachability",bn(zi,Cn),ji.STAT_EVENT="statevent",bn(Gi,Cn),ji.Ua="timingevent",bn(Qi,Cn);var Yi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Xi={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ji(){}function Zi(t){return t.h||(t.h=t.i())}function ts(){}Ji.prototype.h=null;var es,ns={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function is(){Cn.call(this,"d")}function ss(){Cn.call(this,"c")}function rs(){}function os(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new Oi(this),this.P=cs,t=Fn?125:void 0,this.V=new ki(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new as}function as(){this.i=null,this.g="",this.h=!1}bn(is,Cn),bn(ss,Cn),bn(rs,Ji),rs.prototype.g=function(){return new XMLHttpRequest},rs.prototype.i=function(){return{}},es=new rs;var cs=45e3,us={},ls={};function hs(t,e,n){t.L=1,t.v=ks(Cs(e)),t.s=n,t.S=!0,ds(t,null)}function ds(t,e){t.G=Date.now(),ms(t),t.A=Cs(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),$s(n.i,"t",i),t.C=0,n=t.l.J,t.h=new as,t.g=$r(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Mi(vn(t.Pa,t,t.g),t.O)),Fi(t.U,t.g,"readystatechange",t.nb),e=t.I?Jn(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Ki(),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function fs(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function ps(t,e,n){let i,s=!0;for(;!t.J&&t.C<n.length;){if(i=gs(t,n),i==ls){4==e&&(t.o=4,Hi(14),s=!1),Bi(t.j,t.m,null,"[Incomplete Response]");break}if(i==us){t.o=4,Hi(15),Bi(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Bi(t.j,t.m,i,null),Es(t,i)}fs(t)&&i!=ls&&i!=us&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Hi(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Or(e),e.M=!0,Hi(11))):(Bi(t.j,t.m,n,"[Invalid Chunked Response]"),bs(t),ws(t))}function gs(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?ls:(n=Number(e.substring(n,i)),isNaN(n)?us:(i+=1)+n>e.length?ls:(e=e.slice(i,i+n),t.C=i+n,e))}function ms(t){t.Y=Date.now()+t.P,ys(t,t.P)}function ys(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Wi(vn(t.lb,t),e)}function vs(t){t.B&&(hn.clearTimeout(t.B),t.B=null)}function ws(t){0==t.l.H||t.J||Vr(t.l,t)}function bs(t){vs(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,xi(t.V),Vi(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Es(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Ys(n.i,t)))if(!t.K&&Ys(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Fr(n),Ar(n)}Mr(n),Hi(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Wi(vn(n.ib,n),6e3));if(1>=Ws(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Br(n,11)}else if((t.K||n.g==t)&&Fr(n),!An(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=u[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(i=1.5*l,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.i;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Xs(r,r.h),r.h=null))}if(i.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,Ns(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=qr(i,i.J?i.pa:null,i.Y),o.K){Js(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.B&&(vs(a),ms(a)),i.g=o}else Lr(i);0<n.j.length&&Nr(n)}else"stop"!=u[0]&&"close"!=u[0]||Br(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Br(n,7):_r(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Ki()}catch(t){}}function Is(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(dn(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(dn(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(dn(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}(an=os.prototype).setTimeout=function(t){this.P=t},an.nb=function(t){t=t.target;const e=this.M;e&&3==br(t)?e.l():this.Pa(t)},an.Pa=function(t){try{if(t==this.g)t:{const l=br(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Fn||this.g&&(this.h.h||this.g.ja()||Er(this.g)))){this.J||4!=l||7==e||Ki(),vs(this);var n=this.g.da();this.ca=n;e:if(fs(this)){var i=Er(this.g);t="";var s=i.length,r=4==br(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){bs(this),ws(this);var o="";break e}this.h.i=new hn.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!An(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,Hi(12),bs(this),ws(this);break t}Bi(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Es(this,n)}this.S?(ps(this,l,o),Fn&&this.i&&3==l&&(Fi(this.U,this.V,"tick",this.mb),this.V.start())):(Bi(this.j,this.m,o,null),Es(this,o)),4==l&&bs(this),this.i&&!this.J&&(4==l?Vr(this.l,this):(this.i=!1,ms(this)))}else(function(t){const e={};t=(t.g&&2<=br(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(An(t[i]))continue;var n=Ti(t[i]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=e[s]||[];e[s]=r,r.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Hi(12)):(this.o=0,Hi(13)),bs(this),ws(this)}}}catch(t){}},an.mb=function(){if(this.g){var t=br(this.g),e=this.g.ja();this.C<e.length&&(vs(this),ps(this,t,e),this.i&&4!=t&&ms(this))}},an.cancel=function(){this.J=!0,bs(this)},an.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(Ki(),Hi(17)),bs(this),this.o=2,ws(this)):ys(this,this.Y-t)};var Ts=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ss(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Ss){this.h=t.h,_s(this,t.j),this.s=t.s,this.g=t.g,As(this,t.m),this.l=t.l;var e=t.i,n=new Us;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Ds(this,n),this.o=t.o}else t&&(e=String(t).match(Ts))?(this.h=!1,_s(this,e[1]||"",!0),this.s=xs(e[2]||""),this.g=xs(e[3]||"",!0),As(this,e[4]),this.l=xs(e[5]||"",!0),Ds(this,e[6]||"",!0),this.o=xs(e[7]||"")):(this.h=!1,this.i=new Us(null,this.h))}function Cs(t){return new Ss(t)}function _s(t,e,n){t.j=n?xs(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function As(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ds(t,e,n){e instanceof Us?(t.i=e,function(t,e){e&&!t.j&&(Bs(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(js(this,e),$s(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Rs(e,Fs)),t.i=new Us(e,t.h))}function Ns(t,e,n){t.i.set(e,n)}function ks(t){return Ns(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function xs(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Rs(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ls),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ls(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ss.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Rs(e,Ms,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Rs(e,Ms,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Rs(n,"/"==n.charAt(0)?Ps:Os,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Rs(n,Vs)),t.join("")};var Ms=/[#\/\?@]/g,Os=/[#\?:]/g,Ps=/[#\?]/g,Fs=/[#\?@]/g,Vs=/#/g;function Us(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Bs(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function js(t,e){Bs(t),e=zs(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function qs(t,e){return Bs(t),e=zs(t,e),t.g.has(e)}function $s(t,e,n){js(t,e),0<n.length&&(t.i=null,t.g.set(zs(t,e),Tn(n)),t.h+=n.length)}function zs(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(an=Us.prototype).add=function(t,e){Bs(this),this.i=null,t=zs(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},an.forEach=function(t,e){Bs(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},an.ta=function(){Bs(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const s=t[i];for(let t=0;t<s.length;t++)n.push(e[i])}return n},an.Z=function(t){Bs(this);let e=[];if("string"==typeof t)qs(this,t)&&(e=e.concat(this.g.get(zs(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},an.set=function(t,e){return Bs(this),this.i=null,qs(this,t=zs(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},an.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},an.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const r=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),t.push(s)}}return this.i=t.join("&")};var Ks=class{constructor(t,e){this.g=t,this.map=e}};function Gs(t){this.l=t||Hs,t=hn.PerformanceNavigationTiming?0<(t=hn.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(hn.g&&hn.g.Ka&&hn.g.Ka()&&hn.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Hs=10;function Qs(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ws(t){return t.h?1:t.g?t.g.size:0}function Ys(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Xs(t,e){t.g?t.g.add(e):t.h=e}function Js(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Zs(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Tn(t.i)}Gs.prototype.cancel=function(){if(this.i=Zs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var tr=class{stringify(t){return hn.JSON.stringify(t,void 0)}parse(t){return hn.JSON.parse(t,void 0)}};function er(){this.g=new tr}function nr(t,e,n){const i=n||"";try{Is(t,(function(t,n){let s=t;fn(t)&&(s=wi(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function ir(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function sr(t){this.l=t.fc||null,this.j=t.ob||!1}function rr(t,e){mi.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=or,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}bn(sr,Ji),sr.prototype.g=function(){return new rr(this.l,this.j)},sr.prototype.i=function(t){return function(){return t}}({}),bn(rr,mi);var or=0;function ar(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function cr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ur(t)}function ur(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(an=rr.prototype).open=function(t,e){if(this.readyState!=or)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ur(this)},an.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||hn).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},an.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,cr(this)),this.readyState=or},an.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ur(this)),this.g&&(this.readyState=3,ur(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==hn.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ar(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},an.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?cr(this):ur(this),3==this.readyState&&ar(this)}},an.Za=function(t){this.g&&(this.response=this.responseText=t,cr(this))},an.Ya=function(t){this.g&&(this.response=t,cr(this))},an.ka=function(){this.g&&cr(this)},an.setRequestHeader=function(t,e){this.v.append(t,e)},an.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},an.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(rr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var lr=hn.JSON.parse;function hr(t){mi.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=dr,this.L=this.M=!1}bn(hr,mi);var dr="",fr=/^https?$/i,pr=["POST","PUT"];function gr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,mr(t),vr(t)}function mr(t){t.F||(t.F=!0,yi(t,"complete"),yi(t,"error"))}function yr(t){if(t.h&&void 0!==ln&&(!t.C[1]||4!=br(t)||2!=t.da()))if(t.v&&4==br(t))Ri(t.La,0,t);else if(yi(t,"readystatechange"),4==br(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var s=String(t.I).match(Ts)[1]||null;!s&&hn.self&&hn.self.location&&(s=hn.self.location.protocol.slice(0,-1)),i=!fr.test(s?s.toLowerCase():"")}n=i}if(n)yi(t,"complete"),yi(t,"success");else{t.m=6;try{var r=2<br(t)?t.g.statusText:""}catch(t){r=""}t.j=r+" ["+t.da()+"]",mr(t)}}finally{vr(t)}}}function vr(t,e){if(t.g){wr(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||yi(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function wr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(hn.clearTimeout(t.A),t.A=null)}function br(t){return t.g?t.g.readyState:0}function Er(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case dr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ir(t){let e="";return Xn(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Tr(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=Ir(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ns(t,e,n))}function Sr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Cr(t){this.Ga=0,this.j=[],this.l=new Ui,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Sr("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Sr("baseRetryDelayMs",5e3,t),this.hb=Sr("retryDelaySeedMs",1e4,t),this.eb=Sr("forwardChannelMaxRetries",2,t),this.xa=Sr("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Gs(t&&t.concurrentRequestLimit),this.Ja=new er,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function _r(t){if(Dr(t),3==t.H){var e=t.W++,n=Cs(t.I);if(Ns(n,"SID",t.K),Ns(n,"RID",e),Ns(n,"TYPE","terminate"),xr(t,n),(e=new os(t,t.l,e)).L=2,e.v=ks(Cs(n)),n=!1,hn.navigator&&hn.navigator.sendBeacon)try{n=hn.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&hn.Image&&((new Image).src=e.v,n=!0),n||(e.g=$r(e.l,null),e.g.ha(e.v)),e.G=Date.now(),ms(e)}jr(t)}function Ar(t){t.g&&(Or(t),t.g.cancel(),t.g=null)}function Dr(t){Ar(t),t.u&&(hn.clearTimeout(t.u),t.u=null),Fr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&hn.clearTimeout(t.m),t.m=null)}function Nr(t){if(!Qs(t.i)&&!t.m){t.m=!0;var e=t.Na;Ci||Di(),_i||(Ci(),_i=!0),Ai.add(e,t),t.C=0}}function kr(t,e){var n;n=e?e.m:t.W++;const i=Cs(t.I);Ns(i,"SID",t.K),Ns(i,"RID",n),Ns(i,"AID",t.V),xr(t,i),t.o&&t.s&&Tr(i,t.o,t.s),n=new os(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Rr(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Xs(t.i,n),hs(n,i,e)}function xr(t,e){t.na&&Xn(t.na,(function(t,n){Ns(e,n,t)})),t.h&&Is({},(function(t,n){Ns(e,n,t)}))}function Rr(t,e,n){n=Math.min(t.j.length,n);var i=t.h?vn(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),r=!1;else try{nr(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function Lr(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ci||Di(),_i||(Ci(),_i=!0),Ai.add(e,t),t.A=0}}function Mr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Wi(vn(t.Ma,t),Ur(t,t.A)),t.A++,0))}function Or(t){null!=t.B&&(hn.clearTimeout(t.B),t.B=null)}function Pr(t){t.g=new os(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Cs(t.wa);Ns(e,"RID","rpc"),Ns(e,"SID",t.K),Ns(e,"AID",t.V),Ns(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Ns(e,"TO",t.qa),Ns(e,"TYPE","xmlhttp"),xr(t,e),t.o&&t.s&&Tr(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=ks(Cs(e)),n.s=null,n.S=!0,ds(n,t)}function Fr(t){null!=t.v&&(hn.clearTimeout(t.v),t.v=null)}function Vr(t,e){var n=null;if(t.g==e){Fr(t),Or(t),t.g=null;var i=2}else{if(!Ys(t.i,e))return;n=e.F,Js(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var s=t.C;yi(i=$i(),new Qi(i,n)),Nr(t)}else Lr(t);else if(3==(s=e.o)||0==s&&0<e.ca||!(1==i&&function(t,e){return!(Ws(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Wi(vn(t.Na,t,e),Ur(t,t.C)),t.C++,0)))}(t,e)||2==i&&Mr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Br(t,5);break;case 4:Br(t,10);break;case 3:Br(t,6);break;default:Br(t,2)}}function Ur(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Br(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=vn(t.pb,t);n||(n=new Ss("//www.google.com/images/cleardot.gif"),hn.location&&"http"==hn.location.protocol||_s(n,"https"),ks(n)),function(t,e){const n=new Ui;if(hn.Image){const i=new Image;i.onload=wn(ir,n,i,"TestLoadImage: loaded",!0,e),i.onerror=wn(ir,n,i,"TestLoadImage: error",!1,e),i.onabort=wn(ir,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=wn(ir,n,i,"TestLoadImage: timeout",!1,e),hn.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else Hi(2);t.H=0,t.h&&t.h.za(e),jr(t),Dr(t)}function jr(t){if(t.H=0,t.ma=[],t.h){const e=Zs(t.i);0==e.length&&0==t.j.length||(Sn(t.ma,e),Sn(t.ma,t.j),t.i.i.length=0,Tn(t.j),t.j.length=0),t.h.ya()}}function qr(t,e,n){var i=n instanceof Ss?Cs(n):new Ss(n);if(""!=i.g)e&&(i.g=e+"."+i.g),As(i,i.m);else{var s=hn.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new Ss(null);i&&_s(r,i),e&&(r.g=e),s&&As(r,s),n&&(r.l=n),i=r}return n=t.F,e=t.Da,n&&e&&Ns(i,n,e),Ns(i,"VER",t.ra),xr(t,i),i}function $r(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new hr(new sr({ob:!0})):new hr(t.va)).Oa(t.J),e}function zr(){}function Kr(){if(On&&!(10<=Number(zn)))throw Error("Environmental error: no available transport.")}function Gr(t,e){mi.call(this),this.g=new Cr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!An(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!An(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Wr(this)}function Hr(t){is.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Qr(){ss.call(this),this.status=1}function Wr(t){this.g=t}function Yr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Xr(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)i[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var r=t.g[3],o=e+(r^n&(s^r))+i[0]+3614090360&4294967295;o=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=n+(o<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(e=n+((o=e+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=r+((o=s+(e^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+r&4294967295}function Jr(t,e){this.h=e;for(var n=[],i=!0,s=t.length-1;0<=s;s--){var r=0|t[s];i&&r==e||(n[s]=r,i=!1)}this.g=n}(an=hr.prototype).Oa=function(t){this.M=t},an.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():es.g(),this.C=this.u?Zi(this.u):Zi(es),this.g.onreadystatechange=vn(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void gr(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=hn.FormData&&t instanceof hn.FormData,!(0<=In(pr,e))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{wr(this),0<this.B&&((this.L=function(t){return On&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=vn(this.ua,this)):this.A=Ri(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){gr(this,t)}},an.ua=function(){void 0!==ln&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yi(this,"timeout"),this.abort(8))},an.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,yi(this,"complete"),yi(this,"abort"),vr(this))},an.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),vr(this,!0)),hr.$.N.call(this)},an.La=function(){this.s||(this.G||this.v||this.l?yr(this):this.kb())},an.kb=function(){yr(this)},an.isActive=function(){return!!this.g},an.da=function(){try{return 2<br(this)?this.g.status:-1}catch(t){return-1}},an.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},an.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),lr(e)}},an.Ia=function(){return this.m},an.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(an=Cr.prototype).ra=8,an.H=1,an.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new os(this,this.l,t);let r=this.s;if(this.U&&(r?(r=Jn(r),ti(r,this.U)):r=this.U),null!==this.o||this.O||(s.I=r,r=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Rr(this,s,e),Ns(n=Cs(this.I),"RID",t),Ns(n,"CVER",22),this.F&&Ns(n,"X-HTTP-Session-Id",this.F),xr(this,n),r&&(this.O?e="headers="+encodeURIComponent(String(Ir(r)))+"&"+e:this.o&&Tr(n,this.o,r)),Xs(this.i,s),this.bb&&Ns(n,"TYPE","init"),this.P?(Ns(n,"$req",e),Ns(n,"SID","null"),s.aa=!0,hs(s,n,null)):hs(s,n,e),this.H=2}}else 3==this.H&&(t?kr(this,t):0==this.j.length||Qs(this.i)||kr(this))},an.Ma=function(){if(this.u=null,Pr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Wi(vn(this.jb,this),t)}},an.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Hi(10),Ar(this),Pr(this))},an.ib=function(){null!=this.v&&(this.v=null,Ar(this),Mr(this),Hi(19))},an.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Hi(2)):(this.l.info("Failed to ping google.com"),Hi(1))},an.isActive=function(){return!!this.h&&this.h.isActive(this)},(an=zr.prototype).Ba=function(){},an.Aa=function(){},an.za=function(){},an.ya=function(){},an.isActive=function(){return!0},an.Va=function(){},Kr.prototype.g=function(t,e){return new Gr(t,e)},bn(Gr,mi),Gr.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Hi(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=qr(t,null,t.Y),Nr(t)},Gr.prototype.close=function(){_r(this.g)},Gr.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=wi(t),t=n);e.j.push(new Ks(e.fb++,t)),3==e.H&&Nr(e)},Gr.prototype.N=function(){this.g.h=null,delete this.j,_r(this.g),delete this.g,Gr.$.N.call(this)},bn(Hr,is),bn(Qr,ss),bn(Wr,zr),Wr.prototype.Ba=function(){yi(this.g,"a")},Wr.prototype.Aa=function(t){yi(this.g,new Hr(t))},Wr.prototype.za=function(t){yi(this.g,new Qr)},Wr.prototype.ya=function(){yi(this.g,"b")},bn(Yr,(function(){this.blockSize=-1})),Yr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Yr.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,s=this.h,r=0;r<e;){if(0==s)for(;r<=n;)Xr(this,t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[s++]=t.charCodeAt(r++),s==this.blockSize){Xr(this,i),s=0;break}}else for(;r<e;)if(i[s++]=t[r++],s==this.blockSize){Xr(this,i),s=0;break}}this.h=s,this.i+=e},Yr.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var Zr={};function to(t){return-128<=t&&128>t?function(t){var e=Zr;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new Jr([0|t],0>t?-1:0)}(t)}(t):new Jr([0|t],0>t?-1:0)}function eo(t){if(isNaN(t)||!isFinite(t))return io;if(0>t)return co(eo(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=no;return new Jr(e,0)}var no=4294967296,io=to(0),so=to(1),ro=to(16777216);function oo(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function ao(t){return-1==t.h}function co(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new Jr(n,~t.h).add(so)}function uo(t,e){return t.add(co(e))}function lo(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function ho(t,e){this.g=t,this.h=e}function fo(t,e){if(oo(e))throw Error("division by zero");if(oo(t))return new ho(io,io);if(ao(t))return e=fo(co(t),e),new ho(co(e.g),co(e.h));if(ao(e))return e=fo(t,co(e)),new ho(co(e.g),e.h);if(30<t.g.length){if(ao(t)||ao(e))throw Error("slowDivide_ only works with positive integers.");for(var n=so,i=e;0>=i.X(t);)n=po(n),i=po(i);var s=go(n,1),r=go(i,1);for(i=go(i,2),n=go(n,2);!oo(i);){var o=r.add(i);0>=o.X(t)&&(s=s.add(n),r=o),i=go(i,1),n=go(n,1)}return e=uo(t,s.R(e)),new ho(s,e)}for(s=io;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(r=eo(n)).R(e);ao(o)||0<o.X(t);)o=(r=eo(n-=i)).R(e);oo(r)&&(r=so),s=s.add(r),t=uo(t,o)}return new ho(s,t)}function po(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new Jr(n,t.h)}function go(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],r=0;r<i;r++)s[r]=0<e?t.D(r+n)>>>e|t.D(r+n+1)<<32-e:t.D(r+n);return new Jr(s,t.h)}(an=Jr.prototype).ea=function(){if(ao(this))return-co(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:no+i)*e,e*=no}return t},an.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(oo(this))return"0";if(ao(this))return"-"+co(this).toString(t);for(var e=eo(Math.pow(t,6)),n=this,i="";;){var s=fo(n,e).g,r=((0<(n=uo(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(oo(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},an.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},an.X=function(t){return ao(t=uo(this,t))?-1:oo(t)?0:1},an.abs=function(){return ao(this)?co(this):this},an.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var r=i+(65535&this.D(s))+(65535&t.D(s)),o=(r>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);i=o>>>16,r&=65535,o&=65535,n[s]=o<<16|r}return new Jr(n,-2147483648&n[n.length-1]?-1:0)},an.R=function(t){if(oo(this)||oo(t))return io;if(ao(this))return ao(t)?co(this).R(co(t)):co(co(this).R(t));if(ao(t))return co(this.R(co(t)));if(0>this.X(ro)&&0>t.X(ro))return eo(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var r=this.D(i)>>>16,o=65535&this.D(i),a=t.D(s)>>>16,c=65535&t.D(s);n[2*i+2*s]+=o*c,lo(n,2*i+2*s),n[2*i+2*s+1]+=r*c,lo(n,2*i+2*s+1),n[2*i+2*s+1]+=o*a,lo(n,2*i+2*s+1),n[2*i+2*s+2]+=r*a,lo(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new Jr(n,0)},an.gb=function(t){return fo(this,t).h},an.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new Jr(n,this.h&t.h)},an.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new Jr(n,this.h|t.h)},an.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new Jr(n,this.h^t.h)},Kr.prototype.createWebChannel=Kr.prototype.g,Gr.prototype.send=Gr.prototype.u,Gr.prototype.open=Gr.prototype.m,Gr.prototype.close=Gr.prototype.close,Yi.NO_ERROR=0,Yi.TIMEOUT=8,Yi.HTTP_ERROR=6,Xi.COMPLETE="complete",ts.EventType=ns,ns.OPEN="a",ns.CLOSE="b",ns.ERROR="c",ns.MESSAGE="d",mi.prototype.listen=mi.prototype.O,hr.prototype.listenOnce=hr.prototype.P,hr.prototype.getLastError=hr.prototype.Sa,hr.prototype.getLastErrorCode=hr.prototype.Ia,hr.prototype.getStatus=hr.prototype.da,hr.prototype.getResponseJson=hr.prototype.Wa,hr.prototype.getResponseText=hr.prototype.ja,hr.prototype.send=hr.prototype.ha,hr.prototype.setWithCredentials=hr.prototype.Oa,Yr.prototype.digest=Yr.prototype.l,Yr.prototype.reset=Yr.prototype.reset,Yr.prototype.update=Yr.prototype.j,Jr.prototype.add=Jr.prototype.add,Jr.prototype.multiply=Jr.prototype.R,Jr.prototype.modulo=Jr.prototype.gb,Jr.prototype.compare=Jr.prototype.X,Jr.prototype.toNumber=Jr.prototype.ea,Jr.prototype.toString=Jr.prototype.toString,Jr.prototype.getBits=Jr.prototype.D,Jr.fromNumber=eo,Jr.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return co(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=eo(Math.pow(n,8)),s=io,r=0;r<e.length;r+=8){var o=Math.min(8,e.length-r),a=parseInt(e.substring(r,r+o),n);8>o?(o=eo(Math.pow(n,o)),s=s.R(o).add(eo(a))):s=(s=s.R(i)).add(eo(a))}return s};var mo=un.createWebChannelTransport=function(){return new Kr},yo=un.getStatEventTarget=function(){return $i()},vo=un.ErrorCode=Yi,wo=un.EventType=Xi,bo=un.Event=ji,Eo=un.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Io=un.FetchXmlHttpFactory=sr,To=un.WebChannel=ts,So=un.XhrIo=hr,Co=un.Md5=Yr,_o=un.Integer=Jr;const Ao="@firebase/firestore";class Do{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Do.UNAUTHENTICATED=new Do(null),Do.GOOGLE_CREDENTIALS=new Do("google-credentials-uid"),Do.FIRST_PARTY=new Do("first-party-uid"),Do.MOCK_USER=new Do("mock-user");let No="9.23.0";const ko=new A("@firebase/firestore");function xo(){return ko.logLevel}function Ro(t,...e){if(ko.logLevel<=I.DEBUG){const n=e.map(Oo);ko.debug(`Firestore (${No}): ${t}`,...n)}}function Lo(t,...e){if(ko.logLevel<=I.ERROR){const n=e.map(Oo);ko.error(`Firestore (${No}): ${t}`,...n)}}function Mo(t,...e){if(ko.logLevel<=I.WARN){const n=e.map(Oo);ko.warn(`Firestore (${No}): ${t}`,...n)}}function Oo(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Po(t="Unexpected state"){const e=`FIRESTORE (${No}) INTERNAL ASSERTION FAILED: `+t;throw Lo(e),new Error(e)}function Fo(t,e){t||Po()}function Vo(t,e){return t}const Uo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bo extends l{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class jo{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class qo{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class $o{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Do.UNAUTHENTICATED)))}shutdown(){}}class zo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ko{constructor(t){this.t=t,this.currentUser=Do.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new jo;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new jo,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Ro("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Ro("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new jo)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Ro("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Fo("string"==typeof e.accessToken),new qo(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Fo(null===t||"string"==typeof t),new Do(t)}}class Go{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Do.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Ho{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Go(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Do.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qo{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Wo{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&Ro("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,Ro("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Ro("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?i(t):Ro("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Fo("string"==typeof t.token),this.T=t.token,new Qo(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Yo(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Xo{static A(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Yo(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function Jo(t,e){return t<e?-1:t>e?1:0}function Zo(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class ta{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Bo(Uo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Bo(Uo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Bo(Uo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Bo(Uo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ta.fromMillis(Date.now())}static fromDate(t){return ta.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ta(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Jo(this.nanoseconds,t.nanoseconds):Jo(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ea{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ea(t)}static min(){return new ea(new ta(0,0))}static max(){return new ea(new ta(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class na{constructor(t,e,n){void 0===e?e=0:e>t.length&&Po(),void 0===n?n=t.length-e:n>t.length-e&&Po(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===na.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof na?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ia extends na{construct(t,e,n){return new ia(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Bo(Uo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ia(e)}static emptyPath(){return new ia([])}}const sa=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ra extends na{construct(t,e,n){return new ra(t,e,n)}static isValidIdentifier(t){return sa.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ra.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ra(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new Bo(Uo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new Bo(Uo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Bo(Uo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new Bo(Uo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ra(e)}static emptyPath(){return new ra([])}}class oa{constructor(t){this.path=t}static fromPath(t){return new oa(ia.fromString(t))}static fromName(t){return new oa(ia.fromString(t).popFirst(5))}static empty(){return new oa(ia.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ia.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ia.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new oa(new ia(t.slice()))}}function aa(t){return new ca(t.readTime,t.key,-1)}class ca{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ca(ea.min(),oa.empty(),-1)}static max(){return new ca(ea.max(),oa.empty(),-1)}}function ua(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=oa.comparator(t.documentKey,e.documentKey),0!==n?n:Jo(t.largestBatchId,e.largestBatchId))}class la{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function ha(t){if(t.code!==Uo.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;Ro("LocalStore","Unexpectedly lost primary lease")}class da{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Po(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new da(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof da?e:da.resolve(e)}catch(t){return da.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):da.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):da.reject(e)}static resolve(t){return new da(((e,n)=>{e(t)}))}static reject(t){return new da(((e,n)=>{n(t)}))}static waitFor(t){return new da(((e,n)=>{let i=0,s=0,r=!1;t.forEach((t=>{++i,t.next((()=>{++s,r&&s===i&&e()}),(t=>n(t)))})),r=!0,s===i&&e()}))}static or(t){let e=da.resolve(!1);for(const n of t)e=e.next((t=>t?da.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new da(((n,i)=>{const s=t.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===s&&n(r)}),(t=>i(t)))}}))}static doWhile(t,e){return new da(((n,i)=>{const s=()=>{!0===t()?e().next((()=>{s()}),i):n()};s()}))}}function fa(t){return"IndexedDbTransactionError"===t.name}class pa{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function ga(t){return null==t}function ma(t){return 0===t&&1/t==-1/0}pa.ct=-1;function ya(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function va(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function wa(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ba{constructor(t,e){this.comparator=t,this.root=e||Ia.EMPTY}insert(t,e){return new ba(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ia.BLACK,null,null))}remove(t){return new ba(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ia.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ea(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ea(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ea(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ea(this.root,t,this.comparator,!0)}}class Ea{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ia{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Ia.RED,this.left=null!=i?i:Ia.EMPTY,this.right=null!=s?s:Ia.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new Ia(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ia.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Ia.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ia.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ia.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Po();if(this.right.isRed())throw Po();const t=this.left.check();if(t!==this.right.check())throw Po();return t+(this.isRed()?0:1)}}Ia.EMPTY=null,Ia.RED=!0,Ia.BLACK=!1,Ia.EMPTY=new class{constructor(){this.size=0}get key(){throw Po()}get value(){throw Po()}get color(){throw Po()}get left(){throw Po()}get right(){throw Po()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Ia(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ta{constructor(t){this.comparator=t,this.data=new ba(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Sa(this.data.getIterator())}getIteratorFrom(t){return new Sa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ta))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ta(this.comparator);return e.data=t,e}}class Sa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ca{constructor(t){this.fields=t,t.sort(ra.comparator)}static empty(){return new Ca([])}unionWith(t){let e=new Ta(ra.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ca(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zo(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class _a extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Aa{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new _a("Invalid base64 string: "+t):t}}(t);return new Aa(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Aa(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Jo(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Aa.EMPTY_BYTE_STRING=new Aa("");const Da=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Na(t){if(Fo(!!t),"string"==typeof t){let e=0;const n=Da.exec(t);if(Fo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ka(t.seconds),nanos:ka(t.nanos)}}function ka(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function xa(t){return"string"==typeof t?Aa.fromBase64String(t):Aa.fromUint8Array(t)}function Ra(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function La(t){const e=t.mapValue.fields.__previous_value__;return Ra(e)?La(e):e}function Ma(t){const e=Na(t.mapValue.fields.__local_write_time__.timestampValue);return new ta(e.seconds,e.nanos)}class Oa{constructor(t,e,n,i,s,r,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Pa{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Pa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Pa&&t.projectId===this.projectId&&t.database===this.database}}const Fa={fields:{__type__:{stringValue:"__max__"}}};function Va(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ra(t)?4:Ja(t)?9007199254740991:10:Po()}function Ua(t,e){if(t===e)return!0;const n=Va(t);if(n!==Va(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ma(t).isEqual(Ma(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Na(t.timestampValue),i=Na(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return xa(t.bytesValue).isEqual(xa(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ka(t.geoPointValue.latitude)===ka(e.geoPointValue.latitude)&&ka(t.geoPointValue.longitude)===ka(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ka(t.integerValue)===ka(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ka(t.doubleValue),i=ka(e.doubleValue);return n===i?ma(n)===ma(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return Zo(t.arrayValue.values||[],e.arrayValue.values||[],Ua);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(ya(n)!==ya(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Ua(n[t],i[t])))return!1;return!0}(t,e);default:return Po()}}function Ba(t,e){return void 0!==(t.values||[]).find((t=>Ua(t,e)))}function ja(t,e){if(t===e)return 0;const n=Va(t),i=Va(e);if(n!==i)return Jo(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Jo(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ka(t.integerValue||t.doubleValue),i=ka(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return qa(t.timestampValue,e.timestampValue);case 4:return qa(Ma(t),Ma(e));case 5:return Jo(t.stringValue,e.stringValue);case 6:return function(t,e){const n=xa(t),i=xa(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=Jo(n[t],i[t]);if(0!==e)return e}return Jo(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Jo(ka(t.latitude),ka(e.latitude));return 0!==n?n:Jo(ka(t.longitude),ka(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=ja(n[t],i[t]);if(e)return e}return Jo(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Fa&&e===Fa)return 0;if(t===Fa)return 1;if(e===Fa)return-1;const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=Jo(i[t],r[t]);if(0!==e)return e;const o=ja(n[i[t]],s[r[t]]);if(0!==o)return o}return Jo(i.length,r.length)}(t.mapValue,e.mapValue);default:throw Po()}}function qa(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Jo(t,e);const n=Na(t),i=Na(e),s=Jo(n.seconds,i.seconds);return 0!==s?s:Jo(n.nanos,i.nanos)}function $a(t){return za(t)}function za(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Na(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?xa(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,oa.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=za(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+=`${s}:${za(t.fields[s])}`;return n+"}"}(t.mapValue):Po();var e,n}function Ka(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ga(t){return!!t&&"integerValue"in t}function Ha(t){return!!t&&"arrayValue"in t}function Qa(t){return!!t&&"nullValue"in t}function Wa(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ya(t){return!!t&&"mapValue"in t}function Xa(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return va(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Xa(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Xa(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Ja(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Za{constructor(t){this.value=t}static empty(){return new Za({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ya(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Xa(e)}setAll(t){let e=ra.emptyPath(),n={},i=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=Xa(t):i.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());Ya(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ua(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Ya(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){va(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Za(Xa(this.value))}}function tc(t){const e=[];return va(t.fields,((t,n)=>{const i=new ra([t]);if(Ya(n)){const t=tc(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new Ca(e)}class ec{constructor(t,e,n,i,s,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(t){return new ec(t,0,ea.min(),ea.min(),ea.min(),Za.empty(),0)}static newFoundDocument(t,e,n,i){return new ec(t,1,e,ea.min(),n,i,0)}static newNoDocument(t,e){return new ec(t,2,e,ea.min(),ea.min(),Za.empty(),0)}static newUnknownDocument(t,e){return new ec(t,3,e,ea.min(),ea.min(),Za.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ea.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Za.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Za.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ea.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ec&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ec(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nc{constructor(t,e){this.position=t,this.inclusive=e}}function ic(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?oa.comparator(oa.fromName(o.referenceValue),n.key):ja(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function sc(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ua(t.position[n],e.position[n]))return!1;return!0}class rc{constructor(t,e="asc"){this.field=t,this.dir=e}}function oc(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ac{}class cc extends ac{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new gc(t,e,n):"array-contains"===e?new wc(t,n):"in"===e?new bc(t,n):"not-in"===e?new Ec(t,n):"array-contains-any"===e?new Ic(t,n):new cc(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new mc(t,n):new yc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(ja(e,this.value)):null!==e&&Va(this.value)===Va(e)&&this.matchesComparison(ja(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Po()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class uc extends ac{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new uc(t,e)}matches(t){return lc(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function lc(t){return"and"===t.op}function hc(t){return function(t){for(const e of t.filters)if(e instanceof uc)return!1;return!0}(t)&&lc(t)}function dc(t){if(t instanceof cc)return t.field.canonicalString()+t.op.toString()+$a(t.value);if(hc(t))return t.filters.map((t=>dc(t))).join(",");{const e=t.filters.map((t=>dc(t))).join(",");return`${t.op}(${e})`}}function fc(t,e){return t instanceof cc?function(t,e){return e instanceof cc&&t.op===e.op&&t.field.isEqual(e.field)&&Ua(t.value,e.value)}(t,e):t instanceof uc?function(t,e){return e instanceof uc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&fc(n,e.filters[i])),!0)}(t,e):void Po()}function pc(t){return t instanceof cc?function(t){return`${t.field.canonicalString()} ${t.op} ${$a(t.value)}`}(t):t instanceof uc?function(t){return t.op.toString()+" {"+t.getFilters().map(pc).join(" ,")+"}"}(t):"Filter"}class gc extends cc{constructor(t,e,n){super(t,e,n),this.key=oa.fromName(n.referenceValue)}matches(t){const e=oa.comparator(t.key,this.key);return this.matchesComparison(e)}}class mc extends cc{constructor(t,e){super(t,"in",e),this.keys=vc(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class yc extends cc{constructor(t,e){super(t,"not-in",e),this.keys=vc(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function vc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>oa.fromName(t.referenceValue)))}class wc extends cc{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ha(e)&&Ba(e.arrayValue,this.value)}}class bc extends cc{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ba(this.value.arrayValue,e)}}class Ec extends cc{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ba(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ba(this.value.arrayValue,e)}}class Ic extends cc{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ha(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Ba(this.value.arrayValue,t)))}}class Tc{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.dt=null}}function Sc(t,e=null,n=[],i=[],s=null,r=null,o=null){return new Tc(t,e,n,i,s,r,o)}function Cc(t){const e=Vo(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>dc(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ga(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>$a(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>$a(t))).join(",")),e.dt=t}return e.dt}function _c(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!oc(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!fc(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!sc(t.startAt,e.startAt)&&sc(t.endAt,e.endAt)}function Ac(t){return oa.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Dc{constructor(t,e=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Nc(t){return new Dc(t)}function kc(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function xc(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Rc(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Lc(t){return null!==t.collectionGroup}function Mc(t){const e=Vo(t);if(null===e.wt){e.wt=[];const t=Rc(e),n=xc(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new rc(t)),e.wt.push(new rc(ra.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new rc(ra.keyField(),t))}}}return e.wt}function Oc(t){const e=Vo(t);if(!e._t)if("F"===e.limitType)e._t=Sc(e.path,e.collectionGroup,Mc(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Mc(e)){const e="desc"===n.dir?"asc":"desc";t.push(new rc(n.field,e))}const n=e.endAt?new nc(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new nc(e.startAt.position,e.startAt.inclusive):null;e._t=Sc(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e._t}function Pc(t,e){e.getFirstInequalityField(),Rc(t);const n=t.filters.concat([e]);return new Dc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Fc(t,e,n){return new Dc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Vc(t,e){return _c(Oc(t),Oc(e))&&t.limitType===e.limitType}function Uc(t){return`${Cc(Oc(t))}|lt:${t.limitType}`}function Bc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>pc(t))).join(", ")}]`),ga(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>$a(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>$a(t))).join(",")),`Target(${e})`}(Oc(t))}; limitType=${t.limitType})`}function jc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):oa.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Mc(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=ic(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Mc(t),e)||t.endAt&&!function(t,e,n){const i=ic(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Mc(t),e))}(t,e)}function qc(t){return(e,n)=>{let i=!1;for(const s of Mc(t)){const t=$c(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function $c(t,e,n){const i=t.field.isKeyField()?oa.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?ja(i,s):Po()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Po()}}class zc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){va(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return wa(this.inner)}size(){return this.innerSize}}const Kc=new ba(oa.comparator);function Gc(){return Kc}const Hc=new ba(oa.comparator);function Qc(...t){let e=Hc;for(const n of t)e=e.insert(n.key,n);return e}function Wc(t){let e=Hc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Yc(){return Jc()}function Xc(){return Jc()}function Jc(){return new zc((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Zc=new ba(oa.comparator),tu=new Ta(oa.comparator);function eu(...t){let e=tu;for(const n of t)e=e.add(n);return e}const nu=new Ta(Jo);function iu(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ma(e)?"-0":e}}function su(t){return{integerValue:""+t}}function ru(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!ma(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?su(e):iu(t,e)}class ou{constructor(){this._=void 0}}function au(t,e,n){return t instanceof lu?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ra(e)&&(e=La(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof hu?du(t,e):t instanceof fu?pu(t,e):function(t,e){const n=uu(t,e),i=mu(n)+mu(t.gt);return Ga(n)&&Ga(t.gt)?su(i):iu(t.serializer,i)}(t,e)}function cu(t,e,n){return t instanceof hu?du(t,e):t instanceof fu?pu(t,e):n}function uu(t,e){return t instanceof gu?Ga(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class lu extends ou{}class hu extends ou{constructor(t){super(),this.elements=t}}function du(t,e){const n=yu(e);for(const e of t.elements)n.some((t=>Ua(t,e)))||n.push(e);return{arrayValue:{values:n}}}class fu extends ou{constructor(t){super(),this.elements=t}}function pu(t,e){let n=yu(e);for(const e of t.elements)n=n.filter((t=>!Ua(t,e)));return{arrayValue:{values:n}}}class gu extends ou{constructor(t,e){super(),this.serializer=t,this.gt=e}}function mu(t){return ka(t.integerValue||t.doubleValue)}function yu(t){return Ha(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class vu{constructor(t,e){this.version=t,this.transformResults=e}}class wu{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new wu}static exists(t){return new wu(void 0,t)}static updateTime(t){return new wu(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function bu(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Eu{}function Iu(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Ru(t.key,wu.none()):new Au(t.key,t.data,wu.none());{const n=t.data,i=Za.empty();let s=new Ta(ra.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),s=s.add(t)}return new Du(t.key,i,new Ca(s.toArray()),wu.none())}}function Tu(t,e,n){t instanceof Au?function(t,e,n){const i=t.value.clone(),s=ku(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Du?function(t,e,n){if(!bu(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=ku(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Nu(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Su(t,e,n,i){return t instanceof Au?function(t,e,n,i){if(!bu(t.precondition,e))return n;const s=t.value.clone(),r=xu(t.fieldTransforms,i,e);return s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,i):t instanceof Du?function(t,e,n,i){if(!bu(t.precondition,e))return n;const s=xu(t.fieldTransforms,i,e),r=e.data;return r.setAll(Nu(t)),r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return bu(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Cu(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),s=uu(i.transform,t||null);null!=s&&(null===n&&(n=Za.empty()),n.set(i.field,s))}return n||null}function _u(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Zo(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof hu&&e instanceof hu||t instanceof fu&&e instanceof fu?Zo(t.elements,e.elements,Ua):t instanceof gu&&e instanceof gu?Ua(t.gt,e.gt):t instanceof lu&&e instanceof lu}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Au extends Eu{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Du extends Eu{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Nu(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function ku(t,e,n){const i=new Map;Fo(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,cu(o,a,n[s]))}return i}function xu(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,au(t,r,e))}return i}class Ru extends Eu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Lu extends Eu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Mu{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Tu(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Su(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Su(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Xc();return this.mutations.forEach((i=>{const s=t.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=e.has(i.key)?null:o;const a=Iu(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(ea.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),eu())}isEqual(t){return this.batchId===t.batchId&&Zo(this.mutations,t.mutations,((t,e)=>_u(t,e)))&&Zo(this.baseMutations,t.baseMutations,((t,e)=>_u(t,e)))}}class Ou{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){Fo(t.mutations.length===n.length);let i=Zc;const s=t.mutations;for(let t=0;t<s.length;t++)i=i.insert(s[t].key,n[t].version);return new Ou(t,e,n,i)}}class Pu{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Fu{constructor(t,e){this.count=t,this.unchangedNames=e}}var Vu,Uu;function Bu(t){if(void 0===t)return Lo("GRPC error has no .code"),Uo.UNKNOWN;switch(t){case Vu.OK:return Uo.OK;case Vu.CANCELLED:return Uo.CANCELLED;case Vu.UNKNOWN:return Uo.UNKNOWN;case Vu.DEADLINE_EXCEEDED:return Uo.DEADLINE_EXCEEDED;case Vu.RESOURCE_EXHAUSTED:return Uo.RESOURCE_EXHAUSTED;case Vu.INTERNAL:return Uo.INTERNAL;case Vu.UNAVAILABLE:return Uo.UNAVAILABLE;case Vu.UNAUTHENTICATED:return Uo.UNAUTHENTICATED;case Vu.INVALID_ARGUMENT:return Uo.INVALID_ARGUMENT;case Vu.NOT_FOUND:return Uo.NOT_FOUND;case Vu.ALREADY_EXISTS:return Uo.ALREADY_EXISTS;case Vu.PERMISSION_DENIED:return Uo.PERMISSION_DENIED;case Vu.FAILED_PRECONDITION:return Uo.FAILED_PRECONDITION;case Vu.ABORTED:return Uo.ABORTED;case Vu.OUT_OF_RANGE:return Uo.OUT_OF_RANGE;case Vu.UNIMPLEMENTED:return Uo.UNIMPLEMENTED;case Vu.DATA_LOSS:return Uo.DATA_LOSS;default:return Po()}}(Uu=Vu||(Vu={}))[Uu.OK=0]="OK",Uu[Uu.CANCELLED=1]="CANCELLED",Uu[Uu.UNKNOWN=2]="UNKNOWN",Uu[Uu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Uu[Uu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Uu[Uu.NOT_FOUND=5]="NOT_FOUND",Uu[Uu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Uu[Uu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Uu[Uu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Uu[Uu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Uu[Uu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Uu[Uu.ABORTED=10]="ABORTED",Uu[Uu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Uu[Uu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Uu[Uu.INTERNAL=13]="INTERNAL",Uu[Uu.UNAVAILABLE=14]="UNAVAILABLE",Uu[Uu.DATA_LOSS=15]="DATA_LOSS";class ju{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return qu}static getOrCreateInstance(){return null===qu&&(qu=new ju),qu}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let qu=null;const $u=new _o([4294967295,4294967295],0);function zu(t){const e=(new TextEncoder).encode(t),n=new Co;return n.update(e),new Uint8Array(n.digest())}function Ku(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new _o([n,i],0),new _o([s,r],0)]}class Gu{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Hu(`Invalid padding: ${e}`);if(n<0)throw new Hu(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Hu(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Hu(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=_o.fromNumber(this.It)}Et(t,e,n){let i=t.add(e.multiply(_o.fromNumber(n)));return 1===i.compare($u)&&(i=new _o([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=zu(t),[n,i]=Ku(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,i,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),r=new Gu(s,i,e);return n.forEach((t=>r.insert(t))),r}insert(t){if(0===this.It)return;const e=zu(t),[n,i]=Ku(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,i,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Hu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Qu{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,Wu.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Qu(ea.min(),i,new ba(Jo),Gc(),eu())}}class Wu{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Wu(n,e,eu(),eu(),eu())}}class Yu{constructor(t,e,n,i){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=i}}class Xu{constructor(t,e){this.targetId=t,this.Vt=e}}class Ju{constructor(t,e,n=Aa.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Zu{constructor(){this.St=0,this.Dt=nl(),this.Ct=Aa.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=eu(),e=eu(),n=eu();return this.Dt.forEach(((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:Po()}})),new Wu(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=nl()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class tl{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=Gc(),this.zt=el(),this.Wt=new ba(Jo)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:Po()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,i=t.Vt.count,s=this.se(n);if(s){const r=s.target;if(Ac(r))if(0===i){const t=new oa(r.path);this.Yt(n,t,ec.newNoDocument(t,ea.min()))}else Fo(1===i);else{const s=this.ie(n);if(s!==i){const i=this.re(t,s);if(0!==i){this.ee(n);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=ju.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var i,s,r,o,a,c;const u={localCacheCount:e,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===t,hashCount:null!==(i=null==l?void 0:l.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===(r=null===(s=null==l?void 0:l.bits)||void 0===s?void 0:s.bitmap)||void 0===r?void 0:r.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(i,s,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:i}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:s="",padding:r=0},hashCount:o=0}=n;let a,c;try{a=xa(s).toUint8Array()}catch(t){if(t instanceof _a)return Mo("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{c=new Gu(a,r,o)}catch(t){return Mo(t instanceof Hu?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===c.It?1:i!==e-this.oe(t.targetId,c)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{const s=this.Gt.ue(),r=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.vt(r)||(this.Yt(t,n,null),i++)})),i}ce(t){const e=new Map;this.Qt.forEach(((n,i)=>{const s=this.se(i);if(s){if(n.current&&Ac(s.target)){const e=new oa(s.target.path);null!==this.jt.get(e)||this.ae(i,e)||this.Yt(i,e,ec.newNoDocument(e,t))}n.Mt&&(e.set(i,n.Ot()),n.Ft())}}));let n=eu();this.zt.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const i=new Qu(t,e,this.Wt,this.jt,n);return this.jt=Gc(),this.zt=el(),this.Wt=new ba(Jo),i}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const i=this.Zt(t);this.ae(t,e)?i.Bt(e,1):i.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new Zu,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new Ta(Jo),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||Ro("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new Zu),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function el(){return new ba(oa.comparator)}function nl(){return new ba(oa.comparator)}const il={asc:"ASCENDING",desc:"DESCENDING"},sl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rl={and:"AND",or:"OR"};class ol{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function al(t,e){return t.useProto3Json||ga(e)?e:{value:e}}function cl(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ul(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function ll(t,e){return cl(t,e.toTimestamp())}function hl(t){return Fo(!!t),ea.fromTimestamp(function(t){const e=Na(t);return new ta(e.seconds,e.nanos)}(t))}function dl(t,e){return function(t){return new ia(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function fl(t){const e=ia.fromString(t);return Fo(xl(e)),e}function pl(t,e){return dl(t.databaseId,e.path)}function gl(t,e){const n=fl(e);if(n.get(1)!==t.databaseId.projectId)throw new Bo(Uo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Bo(Uo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new oa(vl(n))}function ml(t,e){return dl(t.databaseId,e)}function yl(t){return new ia(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function vl(t){return Fo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function wl(t,e,n){return{name:pl(t,e),fields:n.value.mapValue.fields}}function bl(t,e){return{documents:[ml(t,e.path)]}}function El(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=ml(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ml(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(t){if(0!==t.length)return Nl(uc.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Al(t.field),direction:Sl(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=al(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Il(t){let e=function(t){const e=fl(t);return 4===e.length?ia.emptyPath():vl(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){Fo(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=Tl(t);return e instanceof uc&&hc(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new rc(Dl(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,ga(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new nc(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new nc(n,e)}(n.endAt)),function(t,e,n,i,s,r,o,a){return new Dc(t,e,n,i,s,r,o,a)}(e,s,o,r,a,"F",c,u)}function Tl(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Dl(t.unaryFilter.field);return cc.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Dl(t.unaryFilter.field);return cc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Dl(t.unaryFilter.field);return cc.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Dl(t.unaryFilter.field);return cc.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Po()}}(t):void 0!==t.fieldFilter?function(t){return cc.create(Dl(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Po()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return uc.create(t.compositeFilter.filters.map((t=>Tl(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Po()}}(t.compositeFilter.op))}(t):Po()}function Sl(t){return il[t]}function Cl(t){return sl[t]}function _l(t){return rl[t]}function Al(t){return{fieldPath:t.canonicalString()}}function Dl(t){return ra.fromServerFormat(t.fieldPath)}function Nl(t){return t instanceof cc?function(t){if("=="===t.op){if(Wa(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NAN"}};if(Qa(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Wa(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NOT_NAN"}};if(Qa(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Al(t.field),op:Cl(t.op),value:t.value}}}(t):t instanceof uc?function(t){const e=t.getFilters().map((t=>Nl(t)));return 1===e.length?e[0]:{compositeFilter:{op:_l(t.op),filters:e}}}(t):Po()}function kl(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function xl(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Rl{constructor(t,e,n,i,s=ea.min(),r=ea.min(),o=Aa.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Rl(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Rl(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Rl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Rl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Ll{constructor(t){this.fe=t}}function Ml(t){const e=Il({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Fc(e,e.limit,"L"):e}class Ol{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(ka(t.integerValue));else if("doubleValue"in t){const n=ka(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),ma(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(xa(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?Ja(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):Po()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),oa.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}Ol.Ve=new Ol;class Pl{constructor(){this.rn=new Fl}addToCollectionParentIndex(t,e){return this.rn.add(e),da.resolve()}getCollectionParents(t,e){return da.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return da.resolve()}deleteFieldIndex(t,e){return da.resolve()}getDocumentsMatchingTarget(t,e){return da.resolve(null)}getIndexType(t,e){return da.resolve(0)}getFieldIndexes(t,e){return da.resolve([])}getNextCollectionGroupToUpdate(t){return da.resolve(null)}getMinOffset(t,e){return da.resolve(ca.min())}getMinOffsetFromCollectionGroup(t,e){return da.resolve(ca.min())}updateCollectionGroup(t,e,n){return da.resolve()}updateIndexEntries(t,e){return da.resolve()}}class Fl{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Ta(ia.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Ta(ia.comparator)).toArray()}}new Uint8Array(0);class Vl{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Vl(t,Vl.DEFAULT_COLLECTION_PERCENTILE,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Vl.DEFAULT_COLLECTION_PERCENTILE=10,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vl.DEFAULT=new Vl(41943040,Vl.DEFAULT_COLLECTION_PERCENTILE,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vl.DISABLED=new Vl(-1,0,0);class Ul{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new Ul(0)}static Mn(){return new Ul(-1)}}class Bl{constructor(){this.changes=new zc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ec.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?da.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class jl{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class ql{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Su(n.mutation,t,Ca.empty(),ta.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,eu()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=eu()){const i=Yc();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Qc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Yc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,eu())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let s=Gc();const r=Jc(),o=Jc();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof Du)?s=s.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),Su(o.mutation,e,o.mutation.getFieldMask(),ta.now())):r.set(e.key,Ca.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new jl(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Jc();let i=new ba(((t,e)=>t-e)),s=eu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Ca.empty();o=s.applyToLocalView(r,o),n.set(t,o);const a=(i.get(s.batchId)||eu()).add(t);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=Xc();c.forEach((t=>{if(!s.has(t)){const i=Iu(e.get(t),n.get(t));null!==i&&u.set(t,i),s=s.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,u))}return da.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return oa.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Lc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):da.resolve(Yc());let o=-1,a=s;return r.next((e=>da.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?da.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,eu()))).next((t=>({batchId:o,changes:Wc(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new oa(e)).next((t=>{let e=Qc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let s=Qc();return this.indexManager.getCollectionParents(t,i).next((r=>da.forEach(r,(r=>{const o=function(t,e){return new Dc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,ec.newInvalidDocument(i)))}));let n=Qc();return t.forEach(((t,s)=>{const r=i.get(t);void 0!==r&&Su(r.mutation,s,Ca.empty(),ta.now()),jc(e,s)&&(n=n.insert(t,s))})),n}))}}class $l{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return da.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:hl(n.createTime)}),da.resolve()}getNamedQuery(t,e){return da.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:Ml(t.bundledQuery),readTime:hl(t.readTime)}}(e)),da.resolve()}}class zl{constructor(){this.overlays=new ba(oa.comparator),this.ls=new Map}getOverlay(t,e){return da.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Yc();return da.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.we(t,e,i)})),da.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.ls.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),da.resolve()}getOverlaysForCollection(t,e,n){const i=Yc(),s=e.length+1,r=new oa(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return da.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new ba(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Yc(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Yc(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return da.resolve(o)}we(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Pu(e,n));let s=this.ls.get(e);void 0===s&&(s=eu(),this.ls.set(e,s)),this.ls.set(e,s.add(n.key))}}class Kl{constructor(){this.fs=new Ta(Gl.ds),this.ws=new Ta(Gl._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Gl(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Gl(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new oa(new ia([])),n=new Gl(e,t),i=new Gl(e,t+1),s=[];return this.ws.forEachInRange([n,i],(t=>{this.ys(t),s.push(t.key)})),s}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new oa(new ia([])),n=new Gl(e,t),i=new Gl(e,t+1);let s=eu();return this.ws.forEachInRange([n,i],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Gl(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Gl{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return oa.comparator(t.key,e.key)||Jo(t.As,e.As)}static _s(t,e){return Jo(t.As,e.As)||oa.comparator(t.key,e.key)}}class Hl{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new Ta(Gl.ds)}checkEmpty(t){return da.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Mu(s,e,n,i);this.mutationQueue.push(r);for(const e of i)this.Rs=this.Rs.add(new Gl(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return da.resolve(r)}lookupMutationBatch(t,e){return da.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.bs(n),s=i<0?0:i;return da.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return da.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return da.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Gl(e,0),i=new Gl(e,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([n,i],(t=>{const e=this.Ps(t.As);s.push(e)})),da.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ta(Jo);return e.forEach((t=>{const e=new Gl(t,0),i=new Gl(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,i],(t=>{n=n.add(t.As)}))})),da.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;oa.isDocumentKey(s)||(s=s.child(""));const r=new Gl(new oa(s),0);let o=new Ta(Jo);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.As)),!0)}),r),da.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Fo(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return da.forEach(e.mutations,(i=>{const s=new Gl(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Gl(e,0),i=this.Rs.firstAfterOrEqual(n);return da.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,da.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Ql{constructor(t){this.Ds=t,this.docs=new ba(oa.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return da.resolve(n?n.document.mutableCopy():ec.newInvalidDocument(e))}getEntries(t,e){let n=Gc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ec.newInvalidDocument(t))})),da.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Gc();const r=e.path,o=new oa(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||ua(aa(o),n)<=0||(i.has(o.key)||jc(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return da.resolve(s)}getAllFromCollectionGroup(t,e,n,i){Po()}Cs(t,e){return da.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Wl(this)}getSize(t){return da.resolve(this.size)}}class Wl extends Bl{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.os.addEntry(t,i)):this.os.removeEntry(n)})),da.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class Yl{constructor(t){this.persistence=t,this.xs=new zc((t=>Cc(t)),_c),this.lastRemoteSnapshotVersion=ea.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Kl,this.targetCount=0,this.Ms=Ul.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),da.resolve()}getLastRemoteSnapshotVersion(t){return da.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return da.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),da.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),da.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new Ul(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,da.resolve()}updateTargetData(t,e){return this.Fn(e),da.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,da.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.xs.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),da.waitFor(s).next((()=>i))}getTargetCount(t){return da.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return da.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),da.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((e=>{s.push(i.markPotentiallyOrphaned(t,e))})),da.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),da.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return da.resolve(n)}containsKey(t,e){return da.resolve(this.ks.containsKey(e))}}class Xl{constructor(t,e){this.$s={},this.overlays={},this.Os=new pa(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new Yl(this),this.indexManager=new Pl,this.remoteDocumentCache=function(t){return new Ql(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new Ll(e),this.qs=new $l(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new zl,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new Hl(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){Ro("MemoryPersistence","Starting transaction:",t);const i=new Jl(this.Os.next());return this.referenceDelegate.Us(),n(i).next((t=>this.referenceDelegate.Ks(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Gs(t,e){return da.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class Jl extends la{constructor(t){super(),this.currentSequenceNumber=t}}class Zl{constructor(t){this.persistence=t,this.Qs=new Kl,this.js=null}static zs(t){return new Zl(t)}get Ws(){if(this.js)return this.js;throw Po()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),da.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),da.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),da.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return da.forEach(this.Ws,(n=>{const i=oa.fromPath(n);return this.Hs(t,i).next((t=>{t||e.removeEntry(i,ea.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return da.or([()=>da.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class th{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=i}static Li(t,e){let n=eu(),i=eu();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new th(t,e.fromCache,n,i)}}class eh{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,i){return this.Ki(t,e).next((s=>s||this.Gi(t,e,i,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(kc(e))return da.resolve(null);let n=Oc(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=Fc(e,null,"F"),n=Oc(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const s=eu(...i);return this.Ui.getDocuments(t,s).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.ji(e,i);return this.zi(e,r,s,n.readTime)?this.Ki(t,Fc(e,null,"F")):this.Wi(t,r,e,n)}))))})))))}Gi(t,e,n,i){return kc(e)||i.isEqual(ea.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((s=>{const r=this.ji(e,s);return this.zi(e,r,n,i)?this.Qi(t,e):(xo()<=I.DEBUG&&Ro("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Bc(e)),this.Wi(t,r,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=ea.fromTimestamp(1e9===i?new ta(n+1,0):new ta(n,i));return new ca(s,oa.empty(),e)}(i,-1)))}))}ji(t,e){let n=new Ta(qc(t));return e.forEach(((e,i)=>{jc(t,i)&&(n=n.add(i))})),n}zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(t,e){return xo()<=I.DEBUG&&Ro("QueryEngine","Using full collection scan to execute query:",Bc(e)),this.Ui.getDocumentsMatchingQuery(t,e,ca.min())}Wi(t,e,n,i){return this.Ui.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class nh{constructor(t,e,n,i){this.persistence=t,this.Hi=e,this.serializer=i,this.Ji=new ba(Jo),this.Yi=new zc((t=>Cc(t)),_c),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ql(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function ih(t,e){const n=Vo(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((s=>(i=s,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],r=[];let o=eu();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:s,addedBatchIds:r})))}))}))}function sh(t){const e=Vo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}function rh(t,e){const n=Vo(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function oh(t,e,n){const i=Vo(t),s=i.Ji.get(e),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(t=>i.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!fa(t))throw t;Ro("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.Ji=i.Ji.remove(e),i.Yi.delete(s.target)}function ah(t,e,n){const i=Vo(t);let s=ea.min(),r=eu();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=Vo(t),s=i.Yi.get(n);return void 0!==s?da.resolve(i.Ji.get(s)):i.Bs.getTargetData(e,n)}(i,t,Oc(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>i.Hi.getDocumentsMatchingQuery(t,e,n?s:ea.min(),n?r:eu()))).next((t=>(function(t,e,n){let i=t.Xi.get(e)||ea.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Xi.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ir:r})))))}class ch{constructor(){this.activeTargetIds=nu}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class uh{constructor(){this.Hr=new ch,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new ch,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class lh{Yr(t){}shutdown(){}}class hh{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Ro("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){Ro("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let dh=null;function fh(){return null===dh?dh=268435456+Math.round(2147483648*Math.random()):dh++,"0x"+dh.toString(16)}const ph={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class gh{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const mh="WebChannelConnection";class yh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,i,s){const r=fh(),o=this.To(t,e);Ro("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const a={};return this.Eo(a,i,s),this.Ao(t,o,a,n).then((e=>(Ro("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw Mo("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,i,s,r){return this.Io(t,e,n,i,s)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+No,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=ph[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,i){const s=fh();return new Promise(((r,o)=>{const a=new So;a.setWithCredentials(!0),a.listenOnce(wo.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case vo.NO_ERROR:const e=a.getResponseJson();Ro(mh,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),r(e);break;case vo.TIMEOUT:Ro(mh,`RPC '${t}' ${s} timed out`),o(new Bo(Uo.DEADLINE_EXCEEDED,"Request time out"));break;case vo.HTTP_ERROR:const n=a.getStatus();if(Ro(mh,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Uo).indexOf(e)>=0?e:Uo.UNKNOWN}(e.status);o(new Bo(t,e.message))}else o(new Bo(Uo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Bo(Uo.UNAVAILABLE,"Connection failed."));break;default:Po()}}finally{Ro(mh,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(i);Ro(mh,`RPC '${t}' ${s} sending request:`,i),a.send(e,"POST",c,n,15)}))}Ro(t,e,n){const i=fh(),s=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=mo(),o=yo(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Io({})),this.Eo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");Ro(mh,`Creating RPC '${t}' stream ${i}: ${u}`,a);const l=r.createWebChannel(u,a);let h=!1,d=!1;const f=new gh({ro:e=>{d?Ro(mh,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(h||(Ro(mh,`Opening RPC '${t}' stream ${i} transport.`),l.open(),h=!0),Ro(mh,`RPC '${t}' stream ${i} sending:`,e),l.send(e))},oo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,To.EventType.OPEN,(()=>{d||Ro(mh,`RPC '${t}' stream ${i} transport opened.`)})),p(l,To.EventType.CLOSE,(()=>{d||(d=!0,Ro(mh,`RPC '${t}' stream ${i} transport closed`),f.wo())})),p(l,To.EventType.ERROR,(e=>{d||(d=!0,Mo(mh,`RPC '${t}' stream ${i} transport errored:`,e),f.wo(new Bo(Uo.UNAVAILABLE,"The operation could not be completed")))})),p(l,To.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];Fo(!!s);const r=s,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){Ro(mh,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=Vu[t];if(void 0!==e)return Bu(e)}(e),s=o.message;void 0===n&&(n=Uo.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.wo(new Bo(n,s)),l.close()}else Ro(mh,`RPC '${t}' stream ${i} received:`,s),f._o(s)}})),p(o,bo.STAT_EVENT,(e=>{e.stat===Eo.PROXY?Ro(mh,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Eo.NOPROXY&&Ro(mh,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function vh(){return"undefined"!=typeof document?document:null}function wh(t){return new ol(t,!0)}class bh{constructor(t,e,n=1e3,i=1.5,s=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,e-n);i>0&&Ro("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Eh{constructor(t,e,n,i,s,r,o,a){this.ii=t,this.$o=n,this.Oo=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new bh(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===Uo.RESOURCE_EXHAUSTED?(Lo(e.toString()),Lo("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===Uo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new Bo(Uo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return Ro("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(Ro("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ih extends Eh{constructor(t,e,n,i,s,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,r),this.serializer=s}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Po()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(t,e){return t.useProto3Json?(Fo(void 0===e||"string"==typeof e),Aa.fromBase64String(e||"")):(Fo(void 0===e||e instanceof Uint8Array),Aa.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Uo.UNKNOWN:Bu(t.code);return new Bo(e,t.message||"")}(o);n=new Ju(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=gl(t,i.document.name),r=hl(i.document.updateTime),o=i.document.createTime?hl(i.document.createTime):ea.min(),a=new Za({mapValue:{fields:i.document.fields}}),c=ec.newFoundDocument(s,r,o,a),u=i.targetIds||[],l=i.removedTargetIds||[];n=new Yu(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=gl(t,i.document),r=i.readTime?hl(i.readTime):ea.min(),o=ec.newNoDocument(s,r),a=i.removedTargetIds||[];n=new Yu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=gl(t,i.document),r=i.removedTargetIds||[];n=new Yu([],r,s,null)}else{if(!("filter"in e))return Po();{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:s}=t,r=new Fu(i,s),o=t.targetId;n=new Xu(o,r)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ea.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ea.min():e.readTime?hl(e.readTime):ea.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=yl(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=Ac(i)?{documents:bl(t,i)}:{query:El(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=ul(t,e.resumeToken);const i=al(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(ea.min())>0){n.readTime=cl(t,e.snapshotVersion.toTimestamp());const i=al(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Po()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=yl(this.serializer),e.removeTarget=t,this.Wo(e)}}class Th extends Eh{constructor(t,e,n,i,s,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,r),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(t,e){return this.connection.Ro("Write",t,e)}onMessage(t){if(Fo(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ru){this.qo.reset();const e=function(t,e){return t&&t.length>0?(Fo(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?hl(t.updateTime):hl(e);return n.isEqual(ea.min())&&(n=hl(e)),new vu(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=hl(t.commitTime);return this.listener.cu(n,e)}return Fo(!t.writeResults||0===t.writeResults.length),this.ru=!0,this.listener.au()}hu(){const t={};t.database=yl(this.serializer),this.Wo(t)}uu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Au)n={update:wl(t,e.key,e.value)};else if(e instanceof Ru)n={delete:pl(t,e.key)};else if(e instanceof Du)n={update:wl(t,e.key,e.data),updateMask:kl(e.fieldMask)};else{if(!(e instanceof Lu))return Po();n={verify:pl(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof lu)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof hu)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fu)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof gu)return{fieldPath:e.field.canonicalString(),increment:n.gt};throw Po()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ll(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Po()}(t,e.precondition)),n}(this.serializer,t)))};this.Wo(e)}}class Sh extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new Bo(Uo.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Io(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Uo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Bo(Uo.UNKNOWN,t.toString())}))}vo(t,e,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.vo(t,e,n,s,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Uo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Bo(Uo.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class Ch{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Lo(e),this.mu=!1):Ro("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class _h{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{Oh(this)&&(Ro("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Vo(t);e.vu.add(4),await Dh(e),e.bu.set("Unknown"),e.vu.delete(4),await Ah(e)}(this))}))})),this.bu=new Ch(n,i)}}async function Ah(t){if(Oh(t))for(const e of t.Ru)await e(!0)}async function Dh(t){for(const e of t.Ru)await e(!1)}function Nh(t,e){const n=Vo(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),Mh(n)?Lh(n):Jh(n).Ko()&&xh(n,e))}function kh(t,e){const n=Vo(t),i=Jh(n);n.Au.delete(e),i.Ko()&&Rh(n,e),0===n.Au.size&&(i.Ko()?i.jo():Oh(n)&&n.bu.set("Unknown"))}function xh(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ea.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Jh(t).su(e)}function Rh(t,e){t.Vu.qt(e),Jh(t).iu(e)}function Lh(t){t.Vu=new tl({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),Jh(t).start(),t.bu.gu()}function Mh(t){return Oh(t)&&!Jh(t).Uo()&&t.Au.size>0}function Oh(t){return 0===Vo(t).vu.size}function Ph(t){t.Vu=void 0}async function Fh(t){t.Au.forEach(((e,n)=>{xh(t,e)}))}async function Vh(t,e){Ph(t),Mh(t)?(t.bu.Iu(e),Lh(t)):t.bu.set("Unknown")}async function Uh(t,e,n){if(t.bu.set("Online"),e instanceof Ju&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.Au.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.Au.delete(i),t.Vu.removeTarget(i))}(t,e)}catch(n){Ro("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Bh(t,n)}else if(e instanceof Yu?t.Vu.Ht(e):e instanceof Xu?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(ea.min()))try{const e=await sh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Au.get(i);s&&t.Au.set(i,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const i=t.Au.get(e);if(!i)return;t.Au.set(e,i.withResumeToken(Aa.EMPTY_BYTE_STRING,i.snapshotVersion)),Rh(t,e);const s=new Rl(i.target,e,n,i.sequenceNumber);xh(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Ro("RemoteStore","Failed to raise snapshot:",e),await Bh(t,e)}}async function Bh(t,e,n){if(!fa(e))throw e;t.vu.add(1),await Dh(t),t.bu.set("Offline"),n||(n=()=>sh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ro("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await Ah(t)}))}function jh(t,e){return e().catch((n=>Bh(t,n,e)))}async function qh(t){const e=Vo(t),n=Zh(e);let i=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;$h(e);)try{const t=await rh(e.localStore,i);if(null===t){0===e.Eu.length&&n.jo();break}i=t.batchId,zh(e,t)}catch(t){await Bh(e,t)}Kh(e)&&Gh(e)}function $h(t){return Oh(t)&&t.Eu.length<10}function zh(t,e){t.Eu.push(e);const n=Zh(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function Kh(t){return Oh(t)&&!Zh(t).Uo()&&t.Eu.length>0}function Gh(t){Zh(t).start()}async function Hh(t){Zh(t).hu()}async function Qh(t){const e=Zh(t);for(const n of t.Eu)e.uu(n.mutations)}async function Wh(t,e,n){const i=t.Eu.shift(),s=Ou.from(i,e,n);await jh(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await qh(t)}async function Yh(t,e){e&&Zh(t).ou&&await async function(t,e){if(function(t){switch(t){default:return Po();case Uo.CANCELLED:case Uo.UNKNOWN:case Uo.DEADLINE_EXCEEDED:case Uo.RESOURCE_EXHAUSTED:case Uo.INTERNAL:case Uo.UNAVAILABLE:case Uo.UNAUTHENTICATED:return!1;case Uo.INVALID_ARGUMENT:case Uo.NOT_FOUND:case Uo.ALREADY_EXISTS:case Uo.PERMISSION_DENIED:case Uo.FAILED_PRECONDITION:case Uo.ABORTED:case Uo.OUT_OF_RANGE:case Uo.UNIMPLEMENTED:case Uo.DATA_LOSS:return!0}}(n=e.code)&&n!==Uo.ABORTED){const n=t.Eu.shift();Zh(t).Qo(),await jh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await qh(t)}var n}(t,e),Kh(t)&&Gh(t)}async function Xh(t,e){const n=Vo(t);n.asyncQueue.verifyOperationInProgress(),Ro("RemoteStore","RemoteStore received new credentials");const i=Oh(n);n.vu.add(3),await Dh(n),i&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await Ah(n)}function Jh(t){return t.Su||(t.Su=function(t,e,n){const i=Vo(t);return i.fu(),new Ih(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{uo:Fh.bind(null,t),ao:Vh.bind(null,t),nu:Uh.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),Mh(t)?Lh(t):t.bu.set("Unknown")):(await t.Su.stop(),Ph(t))}))),t.Su}function Zh(t){return t.Du||(t.Du=function(t,e,n){const i=Vo(t);return i.fu(),new Th(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{uo:Hh.bind(null,t),ao:Yh.bind(null,t),au:Qh.bind(null,t),cu:Wh.bind(null,t)}),t.Ru.push((async e=>{e?(t.Du.Qo(),await qh(t)):(await t.Du.stop(),t.Eu.length>0&&(Ro("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))}))),t.Du}class td{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new jo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new td(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bo(Uo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ed(t,e){if(Lo("AsyncQueue",`${e}: ${t}`),fa(t))return new Bo(Uo.UNAVAILABLE,`${e}: ${t}`);throw t}class nd{constructor(t){this.comparator=t?(e,n)=>t(e,n)||oa.comparator(e.key,n.key):(t,e)=>oa.comparator(t.key,e.key),this.keyedMap=Qc(),this.sortedSet=new ba(this.comparator)}static emptySet(t){return new nd(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof nd))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new nd;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class id{constructor(){this.Cu=new ba(oa.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):Po():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class sd{constructor(t,e,n,i,s,r,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,s){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new sd(t,e,nd.emptySet(e),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Vc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class rd{constructor(){this.Nu=void 0,this.listeners=[]}}class od{constructor(){this.queries=new zc((t=>Uc(t)),Vc),this.onlineState="Unknown",this.ku=new Set}}async function ad(t,e){const n=Vo(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new rd),s)try{r.Nu=await n.onListen(i)}catch(t){const n=ed(t,`Initialization of query '${Bc(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.listeners.push(e),e.Mu(n.onlineState),r.Nu&&e.$u(r.Nu)&&hd(n)}async function cd(t,e){const n=Vo(t),i=e.query;let s=!1;const r=n.queries.get(i);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}function ud(t,e){const n=Vo(t);let i=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.$u(t)&&(i=!0);s.Nu=t}}i&&hd(n)}function ld(t,e,n){const i=Vo(t),s=i.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);i.queries.delete(e)}function hd(t){t.ku.forEach((t=>{t.next()}))}class dd{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new sd(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=sd.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class fd{constructor(t){this.key=t}}class pd{constructor(t){this.key=t}}class gd{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=eu(),this.mutatedKeys=eu(),this.tc=qc(t),this.ec=new nd(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new id,i=e?e.ec:this.ec;let s=e?e.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const u=i.get(t),l=jc(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(r=r.add(l),s=d?s.add(t):s.delete(t)):(r=r.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ec:r,ic:n,zi:o,mutatedKeys:s}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const s=t.ic.xu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Po()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const r=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==s.length||a?{snapshot:new sd(this.query,t.ec,i,s,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:r}:{cc:r}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new id,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=eu(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new pd(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new fd(n))})),e}hc(t){this.Yu=t.ir,this.Zu=eu();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return sd.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class md{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class yd{constructor(t){this.key=t,this.fc=!1}}class vd{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.dc={},this.wc=new zc((t=>Uc(t)),Vc),this._c=new Map,this.mc=new Set,this.gc=new ba(oa.comparator),this.yc=new Map,this.Ic=new Kl,this.Tc={},this.Ec=new Map,this.Ac=Ul.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function wd(t,e){const n=function(t){const e=Vo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ed.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Od.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Td.bind(null,e),e.dc.nu=ud.bind(null,e.eventManager),e.dc.Pc=ld.bind(null,e.eventManager),e}(t);let i,s;const r=n.wc.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.lc();else{const t=await function(t,e){const n=Vo(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.Bs.getTargetData(t,e).next((s=>s?(i=s,da.resolve(i)):n.Bs.allocateTargetId(t).next((s=>(i=new Rl(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.Ji.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,Oc(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,s=await async function(t,e,n,i,s){t.Rc=(e,n,i)=>async function(t,e,n,i){let s=e.view.sc(n);s.zi&&(s=await ah(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,s))));const r=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,r);return kd(t,e.targetId,o.cc),o.snapshot}(t,e,n,i);const r=await ah(t.localStore,e,!0),o=new gd(e,r.ir),a=o.sc(r.documents),c=Wu.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);kd(t,n,u.cc);const l=new md(e,n,o);return t.wc.set(e,l),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),u.snapshot}(n,e,i,"current"===r,t.resumeToken),n.isPrimaryClient&&Nh(n.remoteStore,t)}return s}async function bd(t,e){const n=Vo(t),i=n.wc.get(e),s=n._c.get(i.targetId);if(s.length>1)return n._c.set(i.targetId,s.filter((t=>!Vc(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await oh(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),kh(n.remoteStore,i.targetId),Dd(n,i.targetId)})).catch(ha)):(Dd(n,i.targetId),await oh(n.localStore,i.targetId,!0))}async function Ed(t,e){const n=Vo(t);try{const t=await function(t,e){const n=Vo(t),i=e.snapshotVersion;let s=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Zi.newChangeBuffer({trackRemovals:!0});s=n.Ji;const o=[];e.targetChanges.forEach(((r,a)=>{const c=s.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(t,r.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Aa.EMPTY_BYTE_STRING,ea.min()).withLastLimboFreeSnapshotVersion(ea.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,i)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,r)&&o.push(n.Bs.updateTargetData(t,u))}));let a=Gc(),c=eu();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=eu(),s=eu();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=Gc();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(ea.min())?(e.removeEntry(n,r.readTime),i=i.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),i=i.insert(n,r)):Ro("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{nr:i,sr:s}}))}(t,r,e.documentUpdates).next((t=>{a=t.nr,c=t.sr}))),!i.isEqual(ea.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return da.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.yc.get(e);i&&(Fo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.fc=!0:t.modifiedDocuments.size>0?Fo(i.fc):t.removedDocuments.size>0&&(Fo(i.fc),i.fc=!1))})),await Ld(n,t,e)}catch(t){await ha(t)}}function Id(t,e,n){const i=Vo(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.wc.forEach(((n,i)=>{const s=i.view.Mu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Vo(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(i=!0)})),i&&hd(n)}(i.eventManager,e),t.length&&i.dc.nu(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Td(t,e,n){const i=Vo(t);i.sharedClientState.updateQueryState(e,"rejected",n);const s=i.yc.get(e),r=s&&s.key;if(r){let t=new ba(oa.comparator);t=t.insert(r,ec.newNoDocument(r,ea.min()));const n=eu().add(r),s=new Qu(ea.min(),new Map,new ba(Jo),t,n);await Ed(i,s),i.gc=i.gc.remove(r),i.yc.delete(e),Rd(i)}else await oh(i.localStore,e,!1).then((()=>Dd(i,e,n))).catch(ha)}async function Sd(t,e){const n=Vo(t),i=e.batch.batchId;try{const t=await function(t,e){const n=Vo(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),s=n.Zi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const s=n.batch,r=s.keys();let o=da.resolve();return r.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);Fo(null!==r),e.version.compareTo(r)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=eu();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(n.localStore,e);Ad(n,i,null),_d(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Ld(n,t)}catch(t){await ha(t)}}async function Cd(t,e,n){const i=Vo(t);try{const t=await function(t,e){const n=Vo(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Fo(null!==e),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(i.localStore,e);Ad(i,e,n),_d(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Ld(i,t)}catch(n){await ha(n)}}function _d(t,e){(t.Ec.get(e)||[]).forEach((t=>{t.resolve()})),t.Ec.delete(e)}function Ad(t,e,n){const i=Vo(t);let s=i.Tc[i.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),i.Tc[i.currentUser.toKey()]=s}}function Dd(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t._c.get(e))t.wc.delete(i),n&&t.dc.Pc(i,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||Nd(t,e)}))}function Nd(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(kh(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),Rd(t))}function kd(t,e,n){for(const i of n)i instanceof fd?(t.Ic.addReference(i.key,e),xd(t,i)):i instanceof pd?(Ro("SyncEngine","Document no longer in limbo: "+i.key),t.Ic.removeReference(i.key,e),t.Ic.containsKey(i.key)||Nd(t,i.key)):Po()}function xd(t,e){const n=e.key,i=n.path.canonicalString();t.gc.get(n)||t.mc.has(i)||(Ro("SyncEngine","New document in limbo: "+n),t.mc.add(i),Rd(t))}function Rd(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new oa(ia.fromString(e)),i=t.Ac.next();t.yc.set(i,new yd(n)),t.gc=t.gc.insert(n,i),Nh(t.remoteStore,new Rl(Oc(Nc(n.path)),i,"TargetPurposeLimboResolution",pa.ct))}}async function Ld(t,e,n){const i=Vo(t),s=[],r=[],o=[];i.wc.isEmpty()||(i.wc.forEach(((t,a)=>{o.push(i.Rc(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=th.Li(a.targetId,t);r.push(e)}})))})),await Promise.all(o),i.dc.nu(s),await async function(t,e){const n=Vo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>da.forEach(e,(e=>da.forEach(e.Fi,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>da.forEach(e.Bi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!fa(t))throw t;Ro("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,s)}}}(i.localStore,r))}async function Md(t,e){const n=Vo(t);if(!n.currentUser.isEqual(e)){Ro("SyncEngine","User change. New user:",e.toKey());const t=await ih(n.localStore,e);n.currentUser=e,function(t){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new Bo(Uo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ld(n,t.er)}}function Od(t,e){const n=Vo(t),i=n.yc.get(e);if(i&&i.fc)return eu().add(i.key);{let t=eu();const i=n._c.get(e);if(!i)return t;for(const e of i){const i=n.wc.get(e);t=t.unionWith(i.view.nc)}return t}}function Pd(t){const e=Vo(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Sd.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Cd.bind(null,e),e}class Fd{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=wh(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,i){return new nh(t,e,n,i)}(this.persistence,new eh,t.initialUser,this.serializer)}createPersistence(t){return new Xl(Zl.zs,this.serializer)}createSharedClientState(t){return new uh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Vd{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Id(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Md.bind(null,this.syncEngine),await async function(t,e){const n=Vo(t);e?(n.vu.delete(2),await Ah(n)):e||(n.vu.add(2),await Dh(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new od}createDatastore(t){const e=wh(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new yh(i));var i;return function(t,e,n,i){return new Sh(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=t=>Id(this.syncEngine,t,0),r=hh.D()?new hh:new lh,new _h(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new vd(t,e,n,i,s,r);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Vo(t);Ro("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await Dh(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class Ud{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):Lo("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Bd{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Do.UNAUTHENTICATED,this.clientId=Xo.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Ro("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Ro("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Bo(Uo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new jo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ed(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function jd(t,e){t.asyncQueue.verifyOperationInProgress(),Ro("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await ih(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function qd(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ro("FirestoreClient","Using user provided OfflineComponentProvider");try{await jd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Uo.FAILED_PRECONDITION||t.code===Uo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Mo("Error using user provided cache. Falling back to memory cache: "+n),await jd(t,new Fd)}}else Ro("FirestoreClient","Using default OfflineComponentProvider"),await jd(t,new Fd);return t._offlineComponents}(t);Ro("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>Xh(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Xh(e.remoteStore,n))),t._onlineComponents=e}async function $d(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ro("FirestoreClient","Using user provided OnlineComponentProvider"),await qd(t,t._uninitializedComponentsProvider._online)):(Ro("FirestoreClient","Using default OnlineComponentProvider"),await qd(t,new Vd))),t._onlineComponents}async function zd(t){const e=await $d(t),n=e.eventManager;return n.onListen=wd.bind(null,e.syncEngine),n.onUnlisten=bd.bind(null,e.syncEngine),n}function Kd(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Gd=new Map;function Hd(t,e,n){if(!n)throw new Bo(Uo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Qd(t){if(!oa.isDocumentKey(t))throw new Bo(Uo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Wd(t){if(oa.isDocumentKey(t))throw new Bo(Uo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Yd(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Po()}function Xd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Bo(Uo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yd(t);throw new Bo(Uo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Jd{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Bo(Uo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Bo(Uo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new Bo(Uo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Kd(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Bo(Uo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Bo(Uo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Bo(Uo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class Zd{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Bo(Uo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Bo(Uo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new $o;switch(t.type){case"firstParty":return new Ho(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Bo(Uo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Gd.get(t);e&&(Ro("ComponentProvider","Removing Datastore"),Gd.delete(t),e.terminate())}(this),Promise.resolve()}}class tf{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new tf(this.firestore,t,this._key)}}class ef{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ef(this.firestore,t,this._query)}}class nf extends ef{constructor(t,e,n){super(t,e,Nc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new tf(this.firestore,null,new oa(t))}withConverter(t){return new nf(this.firestore,t,this._path)}}function sf(t,e,...n){if(t=m(t),Hd("collection","path",e),t instanceof Zd){const i=ia.fromString(e,...n);return Wd(i),new nf(t,null,i)}{if(!(t instanceof tf||t instanceof nf))throw new Bo(Uo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ia.fromString(e,...n));return Wd(i),new nf(t.firestore,null,i)}}function rf(t,e,...n){if(t=m(t),1===arguments.length&&(e=Xo.A()),Hd("doc","path",e),t instanceof Zd){const i=ia.fromString(e,...n);return Qd(i),new tf(t,null,new oa(i))}{if(!(t instanceof tf||t instanceof nf))throw new Bo(Uo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ia.fromString(e,...n));return Qd(i),new tf(t.firestore,t instanceof nf?t.converter:null,new oa(i))}}class of{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new bh(this,"async_queue_retry"),this.Xc=()=>{const t=vh();t&&Ro("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=vh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=vh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new jo;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!fa(t))throw t;Ro("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Lo("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const i=td.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(i),i}Zc(){this.Wc&&Po()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}class af extends Zd{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new of,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||uf(this),this._firestoreClient.terminate()}}function cf(t){return t._firestoreClient||uf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function uf(t){var e,n,i;const s=t._freezeSettings(),r=function(t,e,n,i){return new Oa(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Kd(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Bd(t._authCredentials,t._appCheckCredentials,t._queue,r),(null===(n=s.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.cache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}class lf{constructor(t){this._byteString=t}static fromBase64String(t){try{return new lf(Aa.fromBase64String(t))}catch(t){throw new Bo(Uo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new lf(Aa.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class hf{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Bo(Uo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ra(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class df{constructor(t){this._methodName=t}}class ff{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Bo(Uo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Bo(Uo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Jo(this._lat,t._lat)||Jo(this._long,t._long)}}const pf=/^__.*__$/;class gf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Du(t,this.data,this.fieldMask,e,this.fieldTransforms):new Au(t,this.data,e,this.fieldTransforms)}}class mf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Du(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function yf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Po()}}class vf{constructor(t,e,n,i,s,r){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(t){return new vf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.aa({path:n,la:!1});return i.fa(t),i}da(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.aa({path:n,la:!1});return i.ua(),i}wa(t){return this.aa({path:void 0,la:!0})}_a(t){return kf(t,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ua(){if(this.path)for(let t=0;t<this.path.length;t++)this.fa(this.path.get(t))}fa(t){if(0===t.length)throw this._a("Document fields must not be empty");if(yf(this.ca)&&pf.test(t))throw this._a('Document fields cannot begin and end with "__"')}}class wf{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||wh(t)}ya(t,e,n,i=!1){return new vf({ca:t,methodName:e,ga:n,path:ra.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bf(t){const e=t._freezeSettings(),n=wh(t._databaseId);return new wf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ef(t,e,n,i,s,r={}){const o=t.ya(r.merge||r.mergeFields?2:0,e,n,s);_f("Data must be an object, but it was:",o,i);const a=Sf(i,o);let c,u;if(r.merge)c=new Ca(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const i of r.mergeFields){const s=Af(e,i,n);if(!o.contains(s))throw new Bo(Uo.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);xf(t,s)||t.push(s)}c=new Ca(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new gf(new Za(a),c,u)}class If extends df{_toFieldTransform(t){if(2!==t.ca)throw 1===t.ca?t._a(`${this._methodName}() can only appear at the top level of your update data`):t._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof If}}function Tf(t,e){if(Cf(t=m(t)))return _f("Unsupported field value:",e,t),Sf(t,e);if(t instanceof df)return function(t,e){if(!yf(e.ca))throw e._a(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e._a(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const s of t){let t=Tf(s,e.wa(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=m(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ru(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ta.fromDate(t);return{timestampValue:cl(e.serializer,n)}}if(t instanceof ta){const n=new ta(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:cl(e.serializer,n)}}if(t instanceof ff)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof lf)return{bytesValue:ul(e.serializer,t._byteString)};if(t instanceof tf){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:dl(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e._a(`Unsupported field value: ${Yd(t)}`)}(t,e)}function Sf(t,e){const n={};return wa(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):va(t,((t,i)=>{const s=Tf(i,e.ha(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function Cf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ta||t instanceof ff||t instanceof lf||t instanceof tf||t instanceof df)}function _f(t,e,n){if(!Cf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=Yd(n);throw"an object"===i?e._a(t+" a custom object"):e._a(t+" "+i)}}function Af(t,e,n){if((e=m(e))instanceof hf)return e._internalPath;if("string"==typeof e)return Nf(t,e);throw kf("Field path arguments must be of type string or ",t,!1,void 0,n)}const Df=new RegExp("[~\\*/\\[\\]]");function Nf(t,e,n){if(e.search(Df)>=0)throw kf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new hf(...e.split("."))._internalPath}catch(i){throw kf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function kf(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new Bo(Uo.INVALID_ARGUMENT,a+t+c)}function xf(t,e){return t.some((t=>t.isEqual(e)))}class Rf{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new tf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Lf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Mf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Lf extends Rf{data(){return super.data()}}function Mf(t,e){return"string"==typeof e?Nf(t,e):e instanceof hf?e._internalPath:e._delegate._internalPath}class Of{}class Pf extends Of{}function Ff(t,e,...n){let i=[];e instanceof Of&&i.push(e),i=i.concat(n),function(t){const e=t.filter((t=>t instanceof Uf)).length,n=t.filter((t=>t instanceof Vf)).length;if(e>1||e>0&&n>0)throw new Bo(Uo.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const e of i)t=e._apply(t);return t}class Vf extends Pf{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Vf(t,e,n)}_apply(t){const e=this._parse(t);return $f(t._query,e),new ef(t.firestore,t.converter,Pc(t._query,e))}_parse(t){const e=bf(t.firestore),n=function(t,e,n,i,s,r,o){let a;if(s.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new Bo(Uo.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){qf(o,r);const e=[];for(const n of o)e.push(jf(i,t,n));a={arrayValue:{values:e}}}else a=jf(i,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||qf(o,r),a=function(t,e,n,i=!1){return Tf(n,t.ya(i?4:3,e))}(n,"where",o,"in"===r||"not-in"===r);return cc.create(s,r,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class Uf extends Of{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Uf(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:uc.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const i=e.getFlattenedFilters();for(const t of i)$f(n,t),n=Pc(n,t)}(t._query,e),new ef(t.firestore,t.converter,Pc(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Bf extends Pf{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Bf(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Bo(Uo.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Bo(Uo.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const i=new rc(e,n);return function(t,e){if(null===xc(t)){const n=Rc(t);null!==n&&zf(0,n,e.field)}}(t,i),i}(t._query,this._field,this._direction);return new ef(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Dc(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function jf(t,e,n){if("string"==typeof(n=m(n))){if(""===n)throw new Bo(Uo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Lc(e)&&-1!==n.indexOf("/"))throw new Bo(Uo.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(ia.fromString(n));if(!oa.isDocumentKey(i))throw new Bo(Uo.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Ka(t,new oa(i))}if(n instanceof tf)return Ka(t,n._key);throw new Bo(Uo.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yd(n)}.`)}function qf(t,e){if(!Array.isArray(t)||0===t.length)throw new Bo(Uo.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $f(t,e){if(e.isInequality()){const n=Rc(t),i=e.field;if(null!==n&&!n.isEqual(i))throw new Bo(Uo.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);const s=xc(t);null!==s&&zf(0,i,s)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Bo(Uo.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Bo(Uo.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function zf(t,e,n){if(!n.isEqual(e))throw new Bo(Uo.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Kf{convertValue(t,e="none"){switch(Va(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ka(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(xa(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Po()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return va(t,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new ff(ka(t.latitude),ka(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=La(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ma(t));default:return null}}convertTimestamp(t){const e=Na(t);return new ta(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ia.fromString(t);Fo(xl(n));const i=new Pa(n.get(1),n.get(3)),s=new oa(n.popFirst(5));return i.isEqual(e)||Lo(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function Gf(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}class Hf{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Qf extends Rf{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Wf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Mf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Wf extends Qf{data(t={}){return super.data(t)}}class Yf{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Hf(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Wf(this._firestore,this._userDataWriter,n.key,n,new Hf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Bo(Uo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const i=new Wf(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Hf(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new Wf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Hf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Xf(e.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Xf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Po()}}function Jf(t){t=Xd(t,tf);const e=Xd(t.firestore,af);return function(t,e,n={}){const i=new jo;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,s){const r=new Ud({next:r=>{e.enqueueAndForget((()=>cd(t,o)));const a=r.docs.has(n);!a&&r.fromCache?s.reject(new Bo(Uo.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&i&&"server"===i.source?s.reject(new Bo(Uo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(r)},error:t=>s.reject(t)}),o=new dd(Nc(n.path),r,{includeMetadataChanges:!0,Ku:!0});return ad(t,o)}(await zd(t),t.asyncQueue,e,n,i))),i.promise}(cf(e),t._key).then((n=>function(t,e,n){const i=n.docs.get(e._key),s=new Zf(t);return new Qf(t,s,e._key,i,new Hf(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}class Zf extends Kf{constructor(t){super(),this.firestore=t}convertBytes(t){return new lf(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new tf(this.firestore,null,e)}}function tp(t){t=Xd(t,ef);const e=Xd(t.firestore,af),n=cf(e),i=new Zf(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Bo(Uo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),function(t,e,n={}){const i=new jo;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,s){const r=new Ud({next:n=>{e.enqueueAndForget((()=>cd(t,o))),n.fromCache&&"server"===i.source?s.reject(new Bo(Uo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new dd(n,r,{includeMetadataChanges:!0,Ku:!0});return ad(t,o)}(await zd(t),t.asyncQueue,e,n,i))),i.promise}(n,t._query).then((n=>new Yf(e,i,t,n)))}function ep(t,e,n){t=Xd(t,tf);const i=Xd(t.firestore,af),s=Gf(t.converter,e,n);return np(i,[Ef(bf(i),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,wu.none())])}function np(t,e){return function(t,e){const n=new jo;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=Pd(t);try{const t=await function(t,e){const n=Vo(t),i=ta.now(),s=e.reduce(((t,e)=>t.add(e.key)),eu());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Gc(),c=eu();return n.Zi.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{r=s;const o=[];for(const t of e){const e=Cu(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Du(t.key,e,tc(e.value.mapValue),wu.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,o,e)})).next((e=>{o=e;const i=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:Wc(r)})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.Tc[t.currentUser.toKey()];i||(i=new ba(Jo)),i=i.insert(e,n),t.Tc[t.currentUser.toKey()]=i}(i,t.batchId,n),await Ld(i,t.changes),await qh(i.remoteStore)}catch(t){const e=ed(t,"Failed to persist write");n.reject(e)}}(await function(t){return $d(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(cf(t),e)}let ip;function sp(){document.getElementById("current-allowance").textContent=(isNaN(ip)?0:ip).toFixed(2)}function rp(t,e){const n=document.getElementById("transactions-body"),i=document.createElement("tr"),s=Number(e.amount),r=e.date.toDate?e.date.toDate().toLocaleDateString():e.date.toLocaleDateString();i.innerHTML=`\n        <td>${e.description}</td>\n        <td>$${s.toFixed(2)}</td>\n        <td>${r}</td>\n        <td><input type="checkbox" ${e.counts?"checked":""} data-id="${t}"></td>\n        <td><button data-id="${t}" class="delete-btn">Delete</button></td>\n    `,i.querySelector('input[type="checkbox"]').addEventListener("change",(e=>async function(t,e){try{const n=rf(window.db,"transactions",t);await function(t,e,n,...i){t=Xd(t,tf);const s=Xd(t.firestore,af),r=bf(s);let o;return o="string"==typeof(e=m(e))||e instanceof hf?function(t,e,n,i,s,r){const o=t.ya(1,e,n),a=[Af(e,i,n)],c=[s];if(r.length%2!=0)throw new Bo(Uo.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(Af(e,r[t])),c.push(r[t+1]);const u=[],l=Za.empty();for(let t=a.length-1;t>=0;--t)if(!xf(u,a[t])){const e=a[t];let n=c[t];n=m(n);const i=o.da(e);if(n instanceof If)u.push(e);else{const t=Tf(n,i);null!=t&&(u.push(e),l.set(e,t))}}const h=new Ca(u);return new mf(l,h,o.fieldTransforms)}(r,"updateDoc",t._key,e,n,i):function(t,e,n,i){const s=t.ya(1,e,n);_f("Data must be an object, but it was:",s,i);const r=[],o=Za.empty();va(i,((t,i)=>{const a=Nf(e,t,n);i=m(i);const c=s.da(a);if(i instanceof If)r.push(a);else{const t=Tf(i,c);null!=t&&(r.push(a),o.set(a,t))}}));const a=new Ca(r);return new mf(o,a,s.fieldTransforms)}(r,"updateDoc",t._key,e),np(s,[o.toMutation(t._key,wu.exists(!0))])}(n,{counts:e}),async function(){try{const t=Ff(sf(window.db,"transactions"),function(){const t=Mf("where","counts");return Vf._create(t,"==",!0)}()),e=await tp(t);let n=0;e.forEach((t=>{n+=t.data().amount}));const i=rf(window.db,"allowance","current");await ep(i,{amount:n}),ip=n,sp()}catch(t){console.error("Error calculating allowance:",t)}}()}catch(t){console.error("Error updating transaction:",t)}}(t,e.target.checked))),i.querySelector(".delete-btn").addEventListener("click",(()=>async function(t){try{const n=rf(window.db,"transactions",t),i=await Jf(n);if(i.exists()){const t=i.data();if(await(e=n,np(Xd(e.firestore,af),[new Ru(e._key,wu.none())])),t.counts){const e=ip-Number(t.amount),n=rf(window.db,"allowance","current");await ep(n,{amount:e}),ip=e,sp()}}document.querySelector(`button[data-id="${t}"]`).closest("tr").remove()}catch(t){console.error("Error deleting transaction:",t)}var e}(t))),n.prepend(i)}!function(t,e=!0){No="9.23.0",Tt(new y("firestore",((t,{instanceIdentifier:n,options:i})=>{const s=t.getProvider("app").getImmediate(),r=new af(new Ko(t.getProvider("auth-internal")),new Wo(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Bo(Uo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pa(t.options.projectId,e)}(s,n),s);return i=Object.assign({useFetchStreams:e},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),Nt(Ao,"3.13.0",t),Nt(Ao,"3.13.0","esm2017")}(),document.addEventListener("DOMContentLoaded",(async()=>{try{0;const t=At({apiKey:"AIzaSyBZYhYF7I9omBU8aWhi4aHoKPpW1qstPOs",authDomain:"automatic-expenses.firebaseapp.com",projectId:"automatic-expenses",storageBucket:"automatic-expenses.firebasestorage.app",messagingSenderId:"44040847013",appId:"1:44040847013:web:b74a0fa66e6f99ba1ad74c",measurementId:"G-7K0JLEX9KQ"});!function(t=Dt()){const e=St(t=m(t),Oe);e.isInitialized()?e.getImmediate():function(t,e={}){const n=St(t,Oe);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw Ve.create("already-initialized")}n.initialize({options:e})}(t)}(t),window.db=function(t){const e="string"==typeof t?t:"(default)",n=St("object"==typeof t?t:Dt(),"firestore").getImmediate({identifier:e});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=r())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})("firestore");t&&function(t,e,n,i={}){var r;const o=(t=Xd(t,Zd))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Mo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Do.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new Bo(Uo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Do(o)}t._authCredentials=new zo(new qo(e,n))}}(n,...t)}return n}(t),await async function(){try{const t=rf(window.db,"allowance","current"),e=await Jf(t);e.exists()?(ip=Number(e.data().amount),sp()):(console.warn("No allowance document found"),ip=0,sp());const n=Ff(sf(window.db,"transactions"),function(t,e="asc"){const n=e,i=Mf("orderBy","date");return Bf._create(i,n)}(0,"desc"));(await tp(n)).forEach((t=>{rp(t.id,t.data())}))}catch(t){console.error("Error loading data:",t)}}()}catch(t){console.error("Firebase initialization error:",t),alert("Error connecting to database. Please check your configuration and try again.")}})),document.getElementById("add-allowance-btn").addEventListener("click",(async function(){const t=Number(document.getElementById("add-amount").value);if(isNaN(t))return 0;try{const e=ip+t,n=rf(window.db,"allowance","current");await ep(n,{amount:e});const i={description:"Allowance",amount:t,date:(new Date).toISOString(),counts:!0},s=sf(window.db,"transactions");rp((await function(t,e){const n=Xd(t.firestore,af),i=rf(t),s=Gf(t.converter,e);return np(n,[Ef(bf(t.firestore),"addDoc",i._key,s,null!==t.converter,{}).toMutation(i._key,wu.exists(!1))]).then((()=>i))}(s,i)).id,i),ip=e,sp(),document.getElementById("add-amount").value=""}catch(t){console.error("Error adding allowance:",t)}}))})();